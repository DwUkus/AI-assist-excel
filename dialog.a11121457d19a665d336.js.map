{"version":3,"file":"dialog.a11121457d19a665d336.js","mappings":"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","sources":["webpack://ai-excel-assistant/./src/services/OpenRouterService.ts","webpack://ai-excel-assistant/./src/services/CommandParser.ts","webpack://ai-excel-assistant/./src/dialog/dialog.ts"],"sourcesContent":["\r\nexport interface LLMMessage {\r\n    role: \"system\" | \"user\" | \"assistant\";\r\n    content: string;\r\n}\r\n\r\nexport interface CompletionResponse {\r\n    content?: string;\r\n    error?: string;\r\n}\r\n\r\nexport class OpenRouterService {\r\n    private static readonly API_URL = \"https://openrouter.ai/api/v1/chat/completions\";\r\n\r\n    static async complete(\r\n        messages: LLMMessage[],\r\n        model: string,\r\n        apiKey: string\r\n    ): Promise<CompletionResponse> {\r\n        if (!apiKey) {\r\n            return { error: \"API Key is missing\" };\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(this.API_URL, {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Authorization\": `Bearer ${apiKey}`,\r\n                    \"HTTP-Referer\": \"https://localhost:3000\", // Required by OpenRouter\r\n                    \"X-Title\": \"AI Excel Assistant\", // Optional\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n                body: JSON.stringify({\r\n                    model: model,\r\n                    messages: messages\r\n                })\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                return { error: `API Error ${response.status}: ${errorText}` };\r\n            }\r\n\r\n            const data = await response.json();\r\n            \r\n            if (data.choices && data.choices.length > 0) {\r\n                return { content: data.choices[0].message.content };\r\n            } else {\r\n                return { error: \"No response from model\" };\r\n            }\r\n\r\n        } catch (e) {\r\n            return { error: `Network error: ${e.message}` };\r\n        }\r\n    }\r\n}\r\n","/*\r\n * CommandParser.ts\r\n * Parses DSL commands from LLM output\r\n */\r\n\r\nexport interface Command {\r\n    type: string;\r\n    args: string[];\r\n    original: string;\r\n}\r\n\r\nexport interface ParseResult {\r\n    text: string;\r\n    commands: Command[];\r\n}\r\n\r\nexport class CommandParser {\r\n    // Commands that require no arguments\r\n    private static NO_ARG_COMMANDS = [\"UNDO\", \"DELETE_ALL_CHARTS\"];\r\n\r\n    static parse(input: string): ParseResult {\r\n        // 1. Remove markdown code blocks but keep content\r\n        let cleanInput = input.replace(/```[\\w]*\\n?([\\s\\S]*?)```/g, '$1');\r\n        \r\n        const commands: Command[] = [];\r\n        let cleanText = cleanInput;\r\n\r\n        const lines = cleanInput.split('\\n');\r\n        \r\n        for (const line of lines) {\r\n            const trimmed = line.trim();\r\n            if (!trimmed) continue;\r\n            \r\n            // Check for no-arg commands first (case-insensitive)\r\n            const upperTrimmed = trimmed.toUpperCase();\r\n            if (this.NO_ARG_COMMANDS.includes(upperTrimmed)) {\r\n                commands.push({ type: upperTrimmed, args: [], original: trimmed });\r\n                cleanText = cleanText.split(trimmed).join(\"\"); \r\n                continue;\r\n            }\r\n\r\n            // Normalize spaces around pipes\r\n            const normalized = trimmed.replace(/\\s*\\|\\s*/g, '|');\r\n\r\n            // Check for piped commands: COMMAND|arg1|arg2... (case-insensitive type)\r\n            const match = normalized.match(/^([A-Za-z][A-Za-z_0-9]+)\\|(.*)$/);\r\n            if (match) {\r\n                const type = match[1].toUpperCase();\r\n                const argsStr = match[2];\r\n                const args = argsStr.split('|').map(a => a.trim());\r\n                const original = trimmed;\r\n\r\n                const expanded = this.expandCommand(type, args, original);\r\n                commands.push(...expanded);\r\n                \r\n                cleanText = cleanText.split(original).join(\"\"); \r\n            }\r\n        }\r\n\r\n        cleanText = cleanText.replace(/\\n\\s*\\n/g, \"\\n\").trim();\r\n        return { text: cleanText, commands };\r\n    }\r\n\r\n    private static expandCommand(type: string, args: string[], original: string): Command[] {\r\n        switch (type) {\r\n            case \"MOVE_ROW\":\r\n                if (args.length >= 2) {\r\n                    return this.expandMoveRow(args, original);\r\n                }\r\n                return [{ type: \"ERROR\", args: [\"MOVE_ROW requires source and target rows\"], original }];\r\n                \r\n            case \"COPY_ROW\":\r\n                if (args.length >= 2) {\r\n                    return [{\r\n                        type: \"COPY\",\r\n                        args: [`${args[0]}:${args[0]}`, `${args[1]}:${args[1]}`],\r\n                        original\r\n                    }];\r\n                }\r\n                return [{ type: \"ERROR\", args: [\"COPY_ROW requires source and target rows\"], original }];\r\n                \r\n            case \"SWAP_ROWS\":\r\n                if (args.length >= 2) {\r\n                    return this.expandSwapRows(args, original);\r\n                }\r\n                return [{ type: \"ERROR\", args: [\"SWAP_ROWS requires two row numbers\"], original }];\r\n        }\r\n        \r\n        // Default: return as-is\r\n        return [{ type, args, original }];\r\n    }\r\n\r\n    private static expandMoveRow(args: string[], original: string): Command[] {\r\n        const sourceRow = parseInt(args[0]);\r\n        const targetRow = parseInt(args[1]);\r\n        \r\n        if (isNaN(sourceRow) || isNaN(targetRow)) {\r\n            console.error(\"Invalid MOVE_ROW arguments:\", args);\r\n            return [{ type: \"ERROR\", args: [\"Invalid row numbers\"], original }];\r\n        }\r\n        \r\n        const position = (args[2] || \"after\").toLowerCase();\r\n        const insertAt = position === \"after\" ? targetRow + 1 : targetRow;\r\n        const expanded: Command[] = [];\r\n        \r\n        if (sourceRow < insertAt) {\r\n            // Moving down\r\n            expanded.push({ \r\n                type: \"INSERT_ROWS\", \r\n                args: [`${insertAt}:${insertAt}`], \r\n                original: `[MOVE‚Üì] Insert at ${insertAt}` \r\n            });\r\n            expanded.push({ \r\n                type: \"COPY\", \r\n                args: [`${sourceRow}:${sourceRow}`, `${insertAt}:${insertAt}`], \r\n                original: `[MOVE‚Üì] Copy ${sourceRow}‚Üí${insertAt}` \r\n            });\r\n            expanded.push({ \r\n                type: \"DELETE_ROWS\", \r\n                args: [`${sourceRow}:${sourceRow}`], \r\n                original: `[MOVE‚Üì] Delete ${sourceRow}` \r\n            });\r\n        } else {\r\n            // Moving up\r\n            const shiftedSource = sourceRow + 1;\r\n            expanded.push({ \r\n                type: \"INSERT_ROWS\", \r\n                args: [`${insertAt}:${insertAt}`], \r\n                original: `[MOVE‚Üë] Insert at ${insertAt}` \r\n            });\r\n            expanded.push({ \r\n                type: \"COPY\", \r\n                args: [`${shiftedSource}:${shiftedSource}`, `${insertAt}:${insertAt}`], \r\n                original: `[MOVE‚Üë] Copy ${shiftedSource}‚Üí${insertAt}` \r\n            });\r\n            expanded.push({ \r\n                type: \"DELETE_ROWS\", \r\n                args: [`${shiftedSource}:${shiftedSource}`], \r\n                original: `[MOVE‚Üë] Delete ${shiftedSource}` \r\n            });\r\n        }\r\n        \r\n        return expanded;\r\n    }\r\n\r\n    private static expandSwapRows(args: string[], original: string): Command[] {\r\n        const row1 = parseInt(args[0]);\r\n        const row2 = parseInt(args[1]);\r\n        \r\n        if (isNaN(row1) || isNaN(row2)) {\r\n            return [{ type: \"ERROR\", args: [\"Invalid row numbers\"], original }];\r\n        }\r\n        \r\n        const tempRow = Math.max(row1, row2) + 1;\r\n        \r\n        return [\r\n            { type: \"INSERT_ROWS\", args: [`${tempRow}:${tempRow}`], original: `[SWAP] Create temp row` },\r\n            { type: \"COPY\", args: [`${row1}:${row1}`, `${tempRow}:${tempRow}`], original: `[SWAP] Save row ${row1}` },\r\n            { type: \"COPY\", args: [`${row2}:${row2}`, `${row1}:${row1}`], original: `[SWAP] ${row2}‚Üí${row1}` },\r\n            { type: \"COPY\", args: [`${tempRow}:${tempRow}`, `${row2}:${row2}`], original: `[SWAP] temp‚Üí${row2}` },\r\n            { type: \"DELETE_ROWS\", args: [`${tempRow}:${tempRow}`], original: `[SWAP] Delete temp` }\r\n        ];\r\n    }\r\n}\r\n","/*\r\n * AI Assistant Dialog Logic\r\n */\r\n\r\n/* global document, Office, console, marked */\r\n\r\nimport \"./dialog.css\";\r\nimport { OpenRouterService, LLMMessage } from \"../services/OpenRouterService\";\r\nimport { CommandParser } from \"../services/CommandParser\";\r\n\r\nOffice.onReady((info) => {\r\n    if (info.host === Office.HostType.Excel) {\r\n        console.log(\"Dialog initialized\");\r\n        // Ensure DOM is ready\r\n        if (document.readyState === \"loading\") {\r\n            document.addEventListener(\"DOMContentLoaded\", initApp);\r\n        } else {\r\n            initApp();\r\n        }\r\n    }\r\n});\r\n\r\nfunction initApp() {\r\n    setupUI();\r\n    loadSessions();\r\n}\r\n\r\n// Session Management\r\ninterface ChatSession {\r\n    id: string;\r\n    title: string;\r\n    messages: LLMMessage[];\r\n    lastModified: number;\r\n}\r\n\r\nlet sessions: Record<string, ChatSession> = {};\r\nlet currentSessionId: string | null = null;\r\n\r\nfunction generateId(): string {\r\n    return Date.now().toString(36) + Math.random().toString(36).slice(2);\r\n}\r\n\r\nfunction saveSessions() {\r\n    localStorage.setItem(\"chat_sessions\", JSON.stringify(sessions));\r\n    localStorage.setItem(\"current_session_id\", currentSessionId || \"\");\r\n}\r\n\r\nfunction loadSessions() {\r\n    const storedSessions = localStorage.getItem(\"chat_sessions\");\r\n    const storedCurrentId = localStorage.getItem(\"current_session_id\");\r\n\r\n    if (storedSessions) {\r\n        try {\r\n            sessions = JSON.parse(storedSessions);\r\n        } catch (e) {\r\n            console.error(\"Failed to parse sessions\", e);\r\n            sessions = {};\r\n        }\r\n    }\r\n\r\n    if (storedCurrentId && sessions[storedCurrentId]) {\r\n        currentSessionId = storedCurrentId;\r\n    } else {\r\n        // Create default if empty\r\n        createNewSession();\r\n    }\r\n    \r\n    renderCurrentSession();\r\n    renderChatList();\r\n}\r\n\r\nfunction createNewSession() {\r\n    const id = generateId();\r\n    sessions[id] = {\r\n        id,\r\n        title: \"New Chat\",\r\n        messages: [{ role: \"assistant\", content: \"–ü—Ä–∏–≤–µ—Ç! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å Excel.\" }],\r\n        lastModified: Date.now()\r\n    };\r\n    currentSessionId = id;\r\n    saveSessions();\r\n    renderCurrentSession();\r\n    renderChatList();\r\n}\r\n\r\nfunction deleteSession(id: string) {\r\n    if (sessions[id]) {\r\n        delete sessions[id];\r\n        if (currentSessionId === id) {\r\n            // Switch to most recent or create new\r\n            const remaining = Object.values(sessions).sort((a, b) => b.lastModified - a.lastModified);\r\n            if (remaining.length > 0) {\r\n                currentSessionId = remaining[0].id;\r\n            } else {\r\n                createNewSession();\r\n                return; // createNewSession handles render\r\n            }\r\n        }\r\n        saveSessions();\r\n        renderCurrentSession();\r\n        renderChatList();\r\n    }\r\n}\r\n\r\nfunction switchSession(id: string) {\r\n    if (sessions[id]) {\r\n        currentSessionId = id;\r\n        saveSessions();\r\n        renderCurrentSession();\r\n        renderChatList();\r\n    }\r\n}\r\n\r\nfunction renderCurrentSession() {\r\n    const container = document.getElementById(\"chat-history\");\r\n    if (!container || !currentSessionId || !sessions[currentSessionId]) return;\r\n\r\n    container.innerHTML = \"\"; // Clear current view\r\n    \r\n    const messages = sessions[currentSessionId].messages;\r\n    messages.forEach(msg => {\r\n        appendMessage(msg.content, msg.role as any);\r\n    });\r\n}\r\n\r\n// Global state for deletion\r\nlet sessionToDelete: string | null = null;\r\n\r\nfunction renderChatList() {\r\n    const listEl = document.getElementById(\"chat-list\");\r\n    if (!listEl) return;\r\n    \r\n    listEl.innerHTML = \"\";\r\n    \r\n    const sortedSessions = Object.values(sessions).sort((a, b) => b.lastModified - a.lastModified);\r\n    \r\n    sortedSessions.forEach(session => {\r\n        const item = document.createElement(\"div\");\r\n        item.className = `chat-item ${session.id === currentSessionId ? \"active\" : \"\"}`;\r\n        item.onclick = () => switchSession(session.id);\r\n        \r\n        const title = document.createElement(\"span\");\r\n        title.className = \"chat-item-title\";\r\n        title.textContent = session.title;\r\n        \r\n        // Menu button (3 dots)\r\n        const menuBtn = document.createElement(\"button\");\r\n        menuBtn.type = \"button\"; // Explicit type\r\n        menuBtn.className = \"chat-item-menu-btn\";\r\n        menuBtn.innerHTML = \"‚ãÆ\";\r\n        \r\n        menuBtn.addEventListener(\"click\", (e) => {\r\n            e.stopPropagation();\r\n            console.log(\"Delete menu clicked for session:\", session.id);\r\n            \r\n            // Show custom modal\r\n            sessionToDelete = session.id;\r\n            const deleteModal = document.getElementById(\"delete-modal\");\r\n            if (deleteModal) {\r\n                deleteModal.classList.remove(\"hidden\");\r\n                // Force display flex just in case\r\n                deleteModal.style.display = \"flex\";\r\n            } else {\r\n                console.error(\"Delete modal not found in DOM\");\r\n            }\r\n        });\r\n\r\n        item.appendChild(title);\r\n        item.appendChild(menuBtn);\r\n        listEl.appendChild(item);\r\n    });\r\n}\r\n\r\nfunction setupUI() {\r\n    const input = document.getElementById(\"user-input\") as HTMLTextAreaElement;\r\n    const sendBtn = document.getElementById(\"send-btn\");\r\n    \r\n    // Delete Modal Logic\r\n    const deleteModal = document.getElementById(\"delete-modal\");\r\n    const confirmDeleteBtn = document.getElementById(\"confirm-delete-btn\");\r\n    const cancelDeleteBtn = document.getElementById(\"cancel-delete-btn\");\r\n\r\n    confirmDeleteBtn?.addEventListener(\"click\", () => {\r\n        if (sessionToDelete) {\r\n            deleteSession(sessionToDelete);\r\n            sessionToDelete = null;\r\n        }\r\n        deleteModal?.classList.add(\"hidden\");\r\n    });\r\n\r\n    cancelDeleteBtn?.addEventListener(\"click\", () => {\r\n        sessionToDelete = null;\r\n        deleteModal?.classList.add(\"hidden\");\r\n    });\r\n    \r\n    // Sidebar Logic\r\n    const sidebar = document.getElementById(\"sidebar\");\r\n    const closeSidebarBtn = document.getElementById(\"sidebar-toggle-close\");\r\n    const openSidebarBtn = document.getElementById(\"sidebar-toggle-open\");\r\n\r\n    function updateSidebarState(collapsed: boolean) {\r\n        if (collapsed) {\r\n            sidebar?.classList.add(\"collapsed\");\r\n            openSidebarBtn?.classList.remove(\"hidden\");\r\n        } else {\r\n            sidebar?.classList.remove(\"collapsed\");\r\n            openSidebarBtn?.classList.add(\"hidden\");\r\n        }\r\n    }\r\n\r\n    closeSidebarBtn?.addEventListener(\"click\", () => updateSidebarState(true));\r\n    openSidebarBtn?.addEventListener(\"click\", () => updateSidebarState(false));\r\n\r\n    const newChatBtn = document.getElementById(\"new-chat-btn\");\r\n    newChatBtn?.addEventListener(\"click\", () => {\r\n        createNewSession();\r\n        // Auto-open sidebar on mobile? Optional.\r\n        if (window.innerWidth < 600) updateSidebarState(true); \r\n    });\r\n\r\n    // Textarea Auto-resize\r\n    input.addEventListener(\"input\", () => {\r\n        input.style.height = \"auto\";\r\n        input.style.height = Math.min(input.scrollHeight, 150) + \"px\"; // Cap at ~6-7 lines\r\n    });\r\n\r\n    // Settings Button (moved to footer)\r\n    const settingsBtn = document.getElementById(\"settings-btn\");\r\n    const modal = document.getElementById(\"settings-modal\");\r\n    const saveSettings = document.getElementById(\"save-settings-btn\");\r\n    const modelSelect = document.getElementById(\"model-select\") as HTMLSelectElement;\r\n    const modelListContainer = document.getElementById(\"model-list\");\r\n    const addModelBtn = document.getElementById(\"add-model-btn\");\r\n\r\n    interface Model {\r\n        id: string;\r\n        name: string;\r\n    }\r\n\r\n    const defaultModels: Model[] = [\r\n        { id: \"stepfun/step-3.5-flash:free\", name: \"StepFun 3.5 Flash (Free)\" },\r\n        { id: \"google/gemini-2.0-flash-thinking-exp:free\", name: \"Gemini 2.0 Flash Thinking (Free)\" },\r\n        { id: \"google/gemini-2.0-flash-exp:free\", name: \"Gemini 2.0 Flash Exp (Free)\" },\r\n        { id: \"google/gemini-2.0-pro-exp-02-05:free\", name: \"Gemini 2.0 Pro Exp (Free)\" },\r\n        { id: \"deepseek/deepseek-r1:free\", name: \"DeepSeek R1 (Free)\" },\r\n        { id: \"meta-llama/llama-3.3-70b-instruct:free\", name: \"Llama 3.3 70B (Free)\" }\r\n    ];\r\n\r\n    let models: Model[] = [];\r\n\r\n    // --- Model Management Logic ---\r\n\r\n    function loadModels() {\r\n        const stored = localStorage.getItem(\"openrouter_models\");\r\n        if (stored) {\r\n            try {\r\n                models = JSON.parse(stored);\r\n            } catch (e) {\r\n                console.error(\"Failed to parse models\", e);\r\n                models = [...defaultModels];\r\n            }\r\n        } else {\r\n            models = [...defaultModels];\r\n        }\r\n        renderModelSelect();\r\n        renderModelList();\r\n    }\r\n\r\n    function saveModels() {\r\n        localStorage.setItem(\"openrouter_models\", JSON.stringify(models));\r\n        renderModelSelect();\r\n        renderModelList();\r\n    }\r\n\r\n    function renderModelSelect() {\r\n        const currentVal = modelSelect.value;\r\n        modelSelect.innerHTML = \"\";\r\n        models.forEach(m => {\r\n            const opt = document.createElement(\"option\");\r\n            opt.value = m.id;\r\n            opt.textContent = m.name;\r\n            modelSelect.appendChild(opt);\r\n        });\r\n        if (currentVal && models.some(m => m.id === currentVal)) {\r\n            modelSelect.value = currentVal;\r\n        } else if (models.length > 0) {\r\n            modelSelect.value = models[0].id; // Default to first\r\n        }\r\n    }\r\n\r\n    function renderModelList() {\r\n        if (!modelListContainer) return;\r\n        modelListContainer.innerHTML = \"\";\r\n        \r\n        models.forEach((m, index) => {\r\n            const item = document.createElement(\"div\");\r\n            item.className = \"model-item\";\r\n            item.innerHTML = `\r\n                <div class=\"model-info\">\r\n                    <span class=\"model-name\">${m.name}</span>\r\n                    <span class=\"model-id\">${m.id}</span>\r\n                </div>\r\n                <button class=\"delete-model-btn\" data-index=\"${index}\" title=\"Delete\">üóëÔ∏è</button>\r\n            `;\r\n            modelListContainer.appendChild(item);\r\n        });\r\n    }\r\n\r\n    // Event Delegation for Delete\r\n    modelListContainer?.addEventListener(\"click\", (e) => {\r\n        const target = e.target as HTMLElement;\r\n        const btn = target.closest(\".delete-model-btn\");\r\n        if (btn) {\r\n            const idx = parseInt(btn.getAttribute(\"data-index\") || \"-1\");\r\n            if (idx > -1) {\r\n                // Use a custom confirm or just proceed? Standard confirm OK.\r\n                // Wrap in try-catch just in case of environment issues\r\n                try {\r\n                    models.splice(idx, 1);\r\n                    saveModels();\r\n                } catch (err) {\r\n                    console.error(\"Delete failed\", err);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // Initialize Models\r\n    loadModels();\r\n\r\n    // Add Model Listener\r\n    addModelBtn?.addEventListener(\"click\", () => {\r\n        const idInput = document.getElementById(\"new-model-id\") as HTMLInputElement;\r\n        const nameInput = document.getElementById(\"new-model-name\") as HTMLInputElement;\r\n        \r\n        const id = idInput.value.trim();\r\n        const name = nameInput.value.trim();\r\n\r\n        if (!id || !name) {\r\n            alert(\"Please enter both Model ID and Display Name\");\r\n            return;\r\n        }\r\n\r\n        models.push({ id, name });\r\n        saveModels();\r\n        \r\n        idInput.value = \"\";\r\n        nameInput.value = \"\";\r\n    });\r\n\r\n    // Load saved key if available\r\n    const savedKey = localStorage.getItem(\"openrouter_key\");\r\n    if (savedKey) {\r\n        (document.getElementById(\"api-key-input\") as HTMLInputElement).value = savedKey;\r\n    }\r\n\r\n    // Settings Modal\r\n    settingsBtn?.addEventListener(\"click\", () => {\r\n        modal?.classList.remove(\"hidden\");\r\n        // Re-render list to ensure freshness\r\n        renderModelList(); \r\n    });\r\n    \r\n    document.getElementById(\"close-settings-btn\")?.addEventListener(\"click\", () => modal?.classList.add(\"hidden\"));\r\n    \r\n    saveSettings?.addEventListener(\"click\", () => {\r\n        const key = (document.getElementById(\"api-key-input\") as HTMLInputElement).value.trim();\r\n        if (key) {\r\n            localStorage.setItem(\"openrouter_key\", key);\r\n            appendMessage(\"API Key saved!\", \"ai\");\r\n            // Don't auto-close, let user manage models too\r\n        } \r\n        \r\n        // Also save models just in case (though they save on add/delete)\r\n        saveModels();\r\n        modal?.classList.add(\"hidden\");\r\n    });\r\n\r\n    // --- Context & Command Bridge ---\r\n    let pendingContextResolve: ((value: any) => void) | null = null;\r\n    let pendingExecResolve: ((value: any) => void) | null = null;\r\n\r\n    Office.context.ui.addHandlerAsync(Office.EventType.DialogParentMessageReceived, (arg: any) => {\r\n        console.log(\"Message from parent:\", arg.message);\r\n        try {\r\n            const msg = JSON.parse(arg.message);\r\n            if (msg.type === \"CONTEXT\" && pendingContextResolve) {\r\n                pendingContextResolve(msg.data);\r\n                pendingContextResolve = null;\r\n            } else if (msg.type === \"EXECUTION_RESULT\" && pendingExecResolve) {\r\n                pendingExecResolve(msg.data);\r\n                pendingExecResolve = null;\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Failed to parse parent message\", e);\r\n        }\r\n    });\r\n\r\n    function getContextFromParent(): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            pendingContextResolve = resolve;\r\n            Office.context.ui.messageParent(\"GET_CONTEXT\");\r\n            // Timeout fallback?\r\n            setTimeout(() => {\r\n                if (pendingContextResolve) {\r\n                    console.warn(\"Context request timed out\");\r\n                    pendingContextResolve({}); // Resolve empty to avoid hanging\r\n                    pendingContextResolve = null;\r\n                }\r\n            }, 3000);\r\n        });\r\n    }\r\n\r\n    function executeCommandsInParent(commands: any[]): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            pendingExecResolve = resolve;\r\n            const payload = JSON.stringify({ type: \"EXECUTE\", commands: commands });\r\n            Office.context.ui.messageParent(payload);\r\n            \r\n            // Timeout?\r\n             setTimeout(() => {\r\n                if (pendingExecResolve) {\r\n                    pendingExecResolve({ success: false, errors: [\"Timeout\"] });\r\n                    pendingExecResolve = null;\r\n                }\r\n            }, 60000); // 60s timeout for Excel ops\r\n        });\r\n    }\r\n\r\n\r\n\r\n    function validateCommands(commands: any[]): { valid: boolean; errors: string[] } {\r\n        const errors: string[] = [];\r\n        \r\n        commands.forEach((cmd, idx) => {\r\n            // Check parser errors\r\n            if (cmd.type === \"ERROR\") {\r\n                errors.push(`Command ${idx + 1}: ${cmd.args[0] || 'Parser error'} ‚Äî ${cmd.original}`);\r\n                return;\r\n            }\r\n\r\n            // Check args existence\r\n            if (cmd.type === \"DELETE_ROWS\" || cmd.type === \"INSERT_ROWS\") {\r\n                if (!cmd.args[0] || !/^\\d+:\\d+$/.test(cmd.args[0])) {\r\n                    errors.push(`Command ${idx + 1} (${cmd.type}): Expected format N:N, got: ${cmd.args[0] || 'empty'}`);\r\n                }\r\n            }\r\n            \r\n            // Validate COPY\r\n            if (cmd.type === \"COPY\" && cmd.args.length < 2) {\r\n                errors.push(`Command ${idx + 1} (COPY): Requires source and target ranges`);\r\n            }\r\n            \r\n            // Validate SET_VALUE/SET_FORMULA\r\n            if ((cmd.type === \"SET_VALUE\" || cmd.type === \"SET_FORMULA\") && cmd.args.length < 2) {\r\n                errors.push(`Command ${idx + 1} (${cmd.type}): Requires address and value`);\r\n            }\r\n            \r\n            // Validate FORMAT commands\r\n            if (cmd.type.startsWith(\"FORMAT_\") && cmd.args.length < 2) {\r\n                errors.push(`Command ${idx + 1} (${cmd.type}): Requires address and value`);\r\n            }\r\n            \r\n            // Validate SORT\r\n            if (cmd.type === \"SORT\" && cmd.args.length < 3) {\r\n                errors.push(`Command ${idx + 1} (SORT): Requires range, column index, and order`);\r\n            }\r\n        });\r\n        \r\n        return { valid: errors.length === 0, errors };\r\n    }\r\n\r\n    // Send Message Logic\r\n    async function sendMessage() {\r\n        if (!currentSessionId || !sessions[currentSessionId]) {\r\n            createNewSession();\r\n        }\r\n        \r\n        const text = input.value.trim();\r\n        if (!text) return;\r\n        \r\n        const apiKey = localStorage.getItem(\"openrouter_key\");\r\n        if (!apiKey) {\r\n            modal?.classList.remove(\"hidden\");\r\n            appendMessage(\"Please set your OpenRouter API Key in settings first.\", \"ai\");\r\n            return;\r\n        }\r\n\r\n        const includeData = (document.getElementById(\"include-data\") as HTMLInputElement).checked;\r\n\r\n        appendMessage(text, \"user\");\r\n        input.value = \"\";\r\n        // Reset height\r\n        input.style.height = \"auto\";\r\n        \r\n        // Show thinking state\r\n        const thinkingId = appendMessage(\"Thinking...\", \"ai\", true);\r\n\r\n        // 1. Get Context\r\n        let contextData = null;\r\n        if (includeData) {\r\n            try {\r\n                contextData = await getContextFromParent();\r\n            } catch (e) {\r\n                console.error(\"Error fetching context\", e);\r\n            }\r\n        }\r\n\r\n        // 2. Prepare System Prompt with DSL Instructions\r\n        const systemPrompt = `You are an Excel automation assistant. You translate user requests into executable commands.\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nEXAMPLES (Follow this reasoning pattern)\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nüìù Example 1: \"–ü–µ—Ä–µ–Ω–µ—Å–∏ —Å—Ç—Ä–æ–∫—É 5 –ø–æ–¥ —Å—Ç—Ä–æ–∫—É 10\"\r\nThinking: Move row 5 to AFTER row 10. Source=5, Target=10, Position=after\r\nMOVE_ROW|5|10|after\r\n\r\nüìù Example 2: \"–£–¥–∞–ª–∏ —Å—Ç—Ä–æ–∫—É —Å –ò–≤–∞–Ω–æ–≤—ã–º\"\r\nContext shows: Row 4 = [\"–ò–≤–∞–Ω–æ–≤\", \"–ú–µ–Ω–µ–¥–∂–µ—Ä\", 50000]\r\nDELETE_ROWS|4:4\r\n\r\nüìù Example 3: \"–°–¥–µ–ª–∞–π —è—á–µ–π–∫—É B2 –∫—Ä–∞—Å–Ω–æ–π –∏ –∂–∏—Ä–Ω–æ–π\"\r\nFORMAT_COLOR|B2|red\r\nFORMAT_BOLD|B2|true\r\n\r\nüìù Example 4: \"–ü–æ–º–µ–Ω—è–π –º–µ—Å—Ç–∞–º–∏ —Å—Ç—Ä–æ–∫–∏ 3 –∏ 7\"\r\nSWAP_ROWS|3|7\r\n\r\nüìù Example 5: \"–°–∫–æ–ø–∏—Ä—É–π —Ç–∞–±–ª–∏—Ü—É A1:D10 –Ω–∞ –Ω–æ–≤—ã–π –ª–∏—Å—Ç\"\r\nCREATE_SHEET|–ö–æ–ø–∏—è\r\nCOPY|Sheet1!A1:D10|–ö–æ–ø–∏—è!A1\r\n\r\nüìù Example 6: User asks \"–ß—Ç–æ –∑–¥–µ—Å—å –Ω–∞–ø–∏—Å–∞–Ω–æ?\"\r\n(This is a QUESTION, not an action request)\r\n‚Üí Reply with text, NO commands\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nINTENT CLASSIFICATION (Check FIRST before generating commands)\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nüîç QUESTION INTENTS (Reply with text, NO commands):\r\n- \"–ß—Ç–æ —ç—Ç–æ?\", \"–°–∫–æ–ª—å–∫–æ?\", \"–ö–∞–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞?\", \"–û–±—ä—è—Å–Ω–∏\"\r\n- \"–ü–æ–º–æ–≥–∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è\", \"–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç\"\r\n\r\nüîß ACTION INTENTS (Output commands ONLY):\r\n- \"–°–¥–µ–ª–∞–π\", \"–£–¥–∞–ª–∏\", \"–ü–µ—Ä–µ–Ω–µ—Å–∏\", \"–°–∫–æ–ø–∏—Ä—É–π\", \"–°–æ–∑–¥–∞–π\"\r\n- \"–ü–æ–∫—Ä–∞—Å—å\", \"–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π\", \"–°–æ—Ä—Ç–∏—Ä—É–π\"\r\n\r\n‚ùì CLARIFICATION NEEDED:\r\n- Ambiguous references: \"—ç—Ç—É —Å—Ç—Ä–æ–∫—É\" (which one?)\r\n- Multiple matches: \"–ò–≤–∞–Ω–æ–≤\" appears in rows 4 and 12\r\n- Missing target: \"–°–∫–æ–ø–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ\" (–∫—É–¥–∞?)\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nCOMMAND REFERENCE\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\n‚ñ∏ CELL OPERATIONS\r\n  SET_VALUE|Address|Value\r\n  SET_FORMULA|Address|Formula  \r\n  FORMAT_BOLD|Address|true/false\r\n  FORMAT_COLOR|Address|ColorCode\r\n  FORMAT_FILL|Address|ColorCode\r\n  CLEAR|Address\r\n  SELECT|Address\r\n\r\n‚ñ∏ ROW OPERATIONS (use row notation like 5:5, NOT A5)\r\n  DELETE_ROWS|RowRange        ‚Üí DELETE_ROWS|5:5 or DELETE_ROWS|2:10\r\n  INSERT_ROWS|RowRange        ‚Üí INSERT_ROWS|5:5 (inserts BEFORE row 5)\r\n  COPY_ROW|SourceRow|TargetRow ‚Üí COPY_ROW|5|10 (copies row 5 to row 10)\r\n  MOVE_ROW|SourceRowIndex|TargetRowIndex|Position ‚Üí Position: before|after\r\n  SWAP_ROWS|Row1|Row2   ‚Üí Swaps row 1 and row 2\r\n\r\n‚ñ∏ COLUMN OPERATIONS  \r\n  DELETE_COLUMNS|ColRange     ‚Üí DELETE_COLUMNS|B:B or DELETE_COLUMNS|A:C\r\n  INSERT_COLUMNS|ColRange     ‚Üí INSERT_COLUMNS|B:B\r\n\r\n‚ñ∏ DATA OPERATIONS\r\n  COPY|SourceRange|TargetRange\r\n  SORT|Range|ColumnIndex(0-based)|Ascending(true/false)\r\n\r\n‚ñ∏ SHEET OPERATIONS\r\n  CREATE_SHEET|Name\r\n  DELETE_SHEET|Name\r\n  RENAME_SHEET|NewName                    (active sheet)\r\n  RENAME_SHEET|OldName|NewName            (specific sheet)\r\n  ACTIVATE_SHEET|Name\r\n\r\n‚ñ∏ CHARTS\r\n  CREATE_CHART|Type|DataRange|Title       (Types: ColumnClustered/Line/Pie/Bar)\r\n  DELETE_CHART|Title\r\n  DELETE_ALL_CHARTS\r\n\r\n‚ñ∏ SPECIAL\r\n  UNDO    (ONLY for explicit: \"–æ—Ç–º–µ–Ω–∏\", \"–Ω–∞–∑–∞–¥\", \"undo\", \"–≤–µ—Ä–Ω–∏\")\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nCRITICAL RULES FOR ROW MOVEMENT\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\n‚ö†Ô∏è RULE 1: INDEX SHIFT AWARENESS\r\nWhen you INSERT a row, all rows BELOW shift down by 1.\r\nWhen you DELETE a row, all rows BELOW shift up by 1.\r\nYou MUST account for this in multi-step operations.\r\n*NOTE: MOVE_ROW command handles this automatically. Prefer using it if possible.*\r\n\r\n‚ö†Ô∏è RULE 2: MOVE ROW ALGORITHM (Manual Steps if not using MOVE_ROW)\r\n- MOVING ROW DOWN (source < target): INSERT at Target+1, COPY, DELETE Source.\r\n- MOVING ROW UP (source > target): INSERT at Target, COPY Source+1, DELETE Source+1.\r\n\r\n‚ö†Ô∏è RULE 3: LANGUAGE INTERPRETATION (Russian)\r\n- \"–ø–æ–¥ —Å—Ç—Ä–æ–∫–æ–π X\" / \"–ø–æ—Å–ª–µ X\" ‚Üí AFTER row X (insert at X+1)\r\n- \"–Ω–∞–¥ —Å—Ç—Ä–æ–∫–æ–π X\" / \"–ø–µ—Ä–µ–¥ X\" / \"–≤—ã—à–µ X\" ‚Üí BEFORE row X (insert at X)\r\n- \"–Ω–∞ –º–µ—Å—Ç–æ X\" ‚Üí REPLACE position X\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nAMBIGUITY HANDLING\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nIf a value appears in MULTIPLE rows:\r\n‚ùå DO NOT execute\r\n‚úÖ ASK: \"–ù–∞—à—ë–ª '–ò–≤–∞–Ω–æ–≤' –≤ —Å—Ç—Ä–æ–∫–∞—Ö 4 –∏ 12. –ö–∞–∫—É—é —Å—Ç—Ä–æ–∫—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å?\"\r\n\r\nIf command is unclear:\r\n‚ùå DO NOT guess\r\n‚úÖ ASK for clarification\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nOUTPUT FORMAT\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\n‚úÖ Commands ONLY (one per line, no extra text)\r\n‚úÖ OR clarifying question ONLY (no commands mixed in)\r\n‚ùå NEVER mix commands with explanatory text`;\r\n\r\n        let fullPrompt = systemPrompt;\r\n\r\n        if (contextData && contextData.sheetName) {\r\n            fullPrompt += `\\n\\nCURRENT EXCEL CONTEXT:\\nSheet: ${contextData.sheetName}\\nSelection: ${contextData.address}\\nValues (Selection):\\n${JSON.stringify(contextData.values)}`;\r\n            if (contextData.usedRange) {\r\n                // Parse start row from address like \"Sheet1!A2:D10\" or \"A2:D10\"\r\n                const rangeAddress = contextData.usedRange.address;\r\n                const addressWithoutSheet = rangeAddress.includes('!') \r\n                    ? rangeAddress.split('!')[1] \r\n                    : rangeAddress;\r\n                \r\n                // Match \"2\" from \"A2\"\r\n                const startRowMatch = addressWithoutSheet.match(/[A-Z]+(\\d+)/i);\r\n                const startRow = startRowMatch ? parseInt(startRowMatch[1]) : 1;\r\n\r\n                const rowsWithNumbers = (contextData.usedRange.values as any[][]).map((row, idx) => \r\n                    `Row ${startRow + idx}: ${JSON.stringify(row)}` \r\n                ).join('\\n');\r\n                \r\n                fullPrompt += `\\n\\nSheet Overview (Used Range: ${contextData.usedRange.address}):\\n${rowsWithNumbers}`;\r\n            }\r\n        }\r\n\r\n        // Construct Message Chain\r\n        // Always start with System Prompt\r\n        const messages: LLMMessage[] = [{ role: \"system\", content: fullPrompt }];\r\n        \r\n        // Append History from current session\r\n        const sessionHistory = sessions[currentSessionId!].messages;\r\n        \r\n        // Limit context window if needed (last 20)\r\n        let contextMessages = sessionHistory;\r\n        if (sessionHistory.length > 20) {\r\n            contextMessages = sessionHistory.slice(sessionHistory.length - 20);\r\n        }\r\n        messages.push(...contextMessages);\r\n        \r\n        // Append Current User Message\r\n        const currentUserMsg: LLMMessage = { role: \"user\", content: text };\r\n        messages.push(currentUserMsg);\r\n\r\n        const model = modelSelect.value;\r\n        const currentId = currentSessionId!; // Capture for async closure\r\n\r\n        try {\r\n            // 3. Call LLM\r\n            const response = await OpenRouterService.complete(messages, model, apiKey);\r\n            removeMessage(thinkingId);\r\n\r\n            if (response.error) {\r\n                appendMessage(`Error: ${response.error}`, \"ai\");\r\n                return;\r\n            }\r\n            \r\n            // Add user message to session history (only on success)\r\n            sessions[currentId].messages.push(currentUserMsg);\r\n            \r\n            // Update Title if it's the first user message (and title is default)\r\n            if (sessions[currentId].messages.length <= 2 && sessions[currentId].title === \"New Chat\") {\r\n                 sessions[currentId].title = text.substring(0, 30) + (text.length > 30 ? \"...\" : \"\");\r\n            }\r\n            sessions[currentId].lastModified = Date.now();\r\n            renderChatList(); // Update sidebar order\r\n\r\n            // 4. Parse Commands\r\n            const rawContent = response.content || \"\";\r\n            \r\n            // Add AI response to history\r\n            const aiMsg: LLMMessage = { role: \"assistant\", content: rawContent };\r\n            sessions[currentId].messages.push(aiMsg);\r\n            saveSessions(); // Save state\r\n\r\n            const parsed = CommandParser.parse(rawContent);\r\n\r\n            // Display \"Clean\" text (chat response)\r\n            if (parsed.text) {\r\n                appendMessage(parsed.text, \"ai\");\r\n            } \r\n            \r\n            // Fallback if empty\r\n            if (!parsed.text && parsed.commands.length === 0) {\r\n                 appendMessage(rawContent || \"(Empty response)\", \"ai\");\r\n            }\r\n\r\n            // 5. Execute Commands\r\n            if (parsed.commands.length > 0) {\r\n                const validation = validateCommands(parsed.commands);\r\n                if (!validation.valid) {\r\n                    appendMessage(`‚ö†Ô∏è Validation Errors:\\n${validation.errors.join(\"\\n\")}`, \"ai\");\r\n                    return;\r\n                }\r\n\r\n                const execMsgId = appendMessage(`Executing ${parsed.commands.length} actions...`, \"ai\", true);\r\n                \r\n                const result = await executeCommandsInParent(parsed.commands);\r\n                \r\n                removeMessage(execMsgId);\r\n                \r\n                if (result.success) {\r\n                    const cmdDisplay = parsed.commands.map(c => c.original).join(\"\\n\");\r\n                    appendMessage(`‚úÖ Executed:\\n${cmdDisplay}`, \"ai\");\r\n                } else {\r\n                    appendMessage(`‚ö†Ô∏è Errors: ${result.errors.join(\", \")}`, \"ai\");\r\n                }\r\n            }\r\n\r\n        } catch (err) {\r\n            removeMessage(thinkingId);\r\n            appendMessage(`System Error: ${err}`, \"ai\");\r\n        }\r\n    }\r\n\r\n    sendBtn?.addEventListener(\"click\", sendMessage);\r\n    \r\n    input.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Enter\" && !e.shiftKey) {\r\n            e.preventDefault();\r\n            sendMessage();\r\n        }\r\n        // Shift+Enter is handled natively by textarea (new line)\r\n    });\r\n}\r\n\r\nfunction appendMessage(text: string, sender: \"user\" | \"ai\", isTemporary: boolean = false): string {\r\n    const container = document.getElementById(\"chat-history\");\r\n    const msgDiv = document.createElement(\"div\");\r\n    const id = `msg-${Date.now()}-${Math.random()}`;\r\n    msgDiv.id = id;\r\n    msgDiv.className = `message message-${sender}${isTemporary ? ' temporary' : ''}`;\r\n    \r\n    const avatar = document.createElement(\"div\");\r\n    avatar.className = \"avatar\";\r\n    avatar.textContent = sender === \"ai\" ? \"ü§ñ\" : \"üë§\";\r\n    \r\n    const content = document.createElement(\"div\");\r\n    content.className = \"message-content\";\r\n    \r\n    if (sender === \"ai\") {\r\n        // Safer marked usage (no raw HTML)\r\n        // @ts-ignore\r\n        const renderer = new marked.Renderer();\r\n        renderer.html = () => ''; \r\n        // @ts-ignore\r\n        content.innerHTML = marked.parse(text, { renderer });\r\n    } else {\r\n        content.innerText = text;\r\n    }\r\n    \r\n    msgDiv.appendChild(avatar);\r\n    msgDiv.appendChild(content);\r\n    \r\n    if (container) {\r\n        container.appendChild(msgDiv);\r\n        container.scrollTop = container.scrollHeight;\r\n    }\r\n\r\n    return id;\r\n}\r\n\r\nfunction removeMessage(id: string) {\r\n    const el = document.getElementById(id);\r\n    if (el) el.remove();\r\n}\r\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_defineProperties","_toPropertyKey","key","_typeof","toPrimitive","String","_toPrimitive","OpenRouterService","_classCallCheck","_callee","messages","model","apiKey","response","errorText","data","_t","_context","error","fetch","this","API_URL","method","headers","concat","body","JSON","stringify","ok","text","status","json","choices","content","message","_complete","arguments","apply","_next","_throw","_x","_x2","_x3","CommandParser","_createClass","input","_step","cleanInput","replace","commands","cleanText","_iterator","_createForOfIteratorHelper","split","s","trimmed","trim","upperTrimmed","toUpperCase","NO_ARG_COMMANDS","includes","push","type","args","original","join","match","map","expanded","expandCommand","_toConsumableArray","err","expandMoveRow","expandSwapRows","sourceRow","parseInt","targetRow","isNaN","console","insertAt","toLowerCase","shiftedSource","row1","row2","tempRow","Math","max","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","toString","slice","constructor","name","test","_unsupportedIterableToArray","_nonIterableSpread","initApp","_document$getElementB","document","getElementById","sendBtn","deleteModal","confirmDeleteBtn","cancelDeleteBtn","addEventListener","sessionToDelete","id","sessions","currentSessionId","remaining","values","sort","b","lastModified","createNewSession","saveSessions","renderCurrentSession","renderChatList","deleteSession","classList","add","sidebar","closeSidebarBtn","openSidebarBtn","updateSidebarState","collapsed","remove","newChatBtn","window","innerWidth","style","height","min","scrollHeight","settingsBtn","modal","saveSettings","modelSelect","modelListContainer","addModelBtn","defaultModels","models","saveModels","localStorage","setItem","renderModelSelect","renderModelList","currentVal","innerHTML","forEach","opt","createElement","textContent","appendChild","some","index","item","className","btn","target","closest","idx","getAttribute","splice","stored","getItem","parse","loadModels","idInput","nameInput","alert","savedKey","appendMessage","pendingContextResolve","pendingExecResolve","getContextFromParent","Office","context","ui","messageParent","setTimeout","warn","executeCommandsInParent","payload","success","errors","validateCommands","cmd","startsWith","valid","sendMessage","_sendMessage","includeData","thinkingId","contextData","fullPrompt","rangeAddress","addressWithoutSheet","startRowMatch","startRow","rowsWithNumbers","sessionHistory","contextMessages","currentUserMsg","currentId","rawContent","aiMsg","parsed","validation","execMsgId","result","cmdDisplay","_t2","checked","sheetName","address","usedRange","row","role","complete","removeMessage","title","substring","Date","now","addHandlerAsync","EventType","DialogParentMessageReceived","arg","log","msg","shiftKey","preventDefault","setupUI","storedSessions","storedCurrentId","loadSessions","_defineProperty","onReady","info","host","HostType","Excel","readyState","random","container","listEl","session","onclick","menuBtn","stopPropagation","display","sender","isTemporary","undefined","msgDiv","avatar","renderer","marked","Renderer","html","innerText","scrollTop","el"],"ignoreList":[],"sourceRoot":""}