{"version":3,"file":"dialog.js","mappings":";iGACIA,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaE,QAGrB,IAAIC,EAASN,EAAyBE,GAAY,CAGjDG,QAAS,CAAC,GAOX,OAHAE,EAAoBL,GAAUI,EAAQA,EAAOD,QAASJ,GAG/CK,EAAOD,OACf,CAGAJ,EAAoBO,EAAID,ECzBxBN,EAAoBQ,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAOC,MAAQ,IAAIC,SAAS,cAAb,EAChB,CAAE,MAAOC,GACR,GAAsB,iBAAXC,OAAqB,OAAOA,MACxC,CACA,CAPuB,GCAxBb,EAAoBc,EAAI,SAASC,EAAKC,GAAQ,OAAOC,OAAOC,UAAUC,eAAeC,KAAKL,EAAKC,EAAO,E,WCAtG,IAAIK,EACArB,EAAoBQ,EAAEc,gBAAeD,EAAYrB,EAAoBQ,EAAEe,SAAW,IACtF,IAAIC,EAAWxB,EAAoBQ,EAAEgB,SACrC,IAAKH,GAAaG,IACbA,EAASC,eAAkE,WAAjDD,EAASC,cAAcC,QAAQC,gBAC5DN,EAAYG,EAASC,cAAcG,MAC/BP,GAAW,CACf,IAAIQ,EAAUL,EAASM,qBAAqB,UAC5C,GAAGD,EAAQE,OAEV,IADA,IAAIC,EAAIH,EAAQE,OAAS,EAClBC,GAAK,KAAOX,IAAc,aAAaY,KAAKZ,KAAaA,EAAYQ,EAAQG,KAAKJ,GAE3F,CAID,IAAKP,EAAW,MAAM,IAAIa,MAAM,yDAChCb,EAAYA,EAAUc,QAAQ,SAAU,IAAIA,QAAQ,OAAQ,IAAIA,QAAQ,QAAS,IAAIA,QAAQ,YAAa,KAC1GnC,EAAoBoC,EAAIf,C,IClBxBrB,EAAoBqC,EAAyB,oBAAbb,UAA4BA,SAASc,SAAYC,KAAKhB,SAASiB,K,8PCC/F,IAAA5B,EAAA6B,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAA/B,EAAA4B,EAAAI,aAAA,yBAAAd,EAAAU,EAAAE,EAAA9B,EAAAkB,GAAA,IAAAe,EAAAH,GAAAA,EAAA1B,qBAAA8B,EAAAJ,EAAAI,EAAAC,EAAAhC,OAAAiC,OAAAH,EAAA7B,WAAA,OAAAiC,EAAAF,EAAA,mBAAAP,EAAAE,EAAA9B,GAAA,IAAAkB,EAAAe,EAAAE,EAAAG,EAAA,EAAAhB,EAAAtB,GAAA,GAAAuC,GAAA,EAAAC,EAAA,CAAAlB,EAAA,EAAAQ,EAAA,EAAAW,EAAA3C,EAAA4C,EAAAC,EAAAL,EAAAK,EAAAC,KAAA9C,EAAA,GAAA6C,EAAA,SAAAhB,EAAAC,GAAA,OAAAV,EAAAS,EAAAM,EAAA,EAAAE,EAAArC,EAAA0C,EAAAV,EAAAF,EAAAc,CAAA,YAAAC,EAAAf,EAAAE,GAAA,IAAAG,EAAAL,EAAAO,EAAAL,EAAAH,EAAA,GAAAY,GAAAD,IAAAtC,GAAA2B,EAAAL,EAAAL,OAAAU,IAAA,KAAA3B,EAAAkB,EAAAI,EAAAK,GAAAgB,EAAAH,EAAAlB,EAAAuB,EAAA3B,EAAA,GAAAU,EAAA,GAAA5B,EAAA6C,IAAAf,KAAAK,EAAAjB,GAAAe,EAAAf,EAAA,OAAAe,EAAA,MAAAf,EAAA,GAAAA,EAAA,GAAApB,GAAAoB,EAAA,IAAAyB,KAAA3C,EAAA4B,EAAA,GAAAe,EAAAzB,EAAA,KAAAe,EAAA,EAAAO,EAAAC,EAAAX,EAAAU,EAAAV,EAAAZ,EAAA,IAAAyB,EAAAE,IAAA7C,EAAA4B,EAAA,GAAAV,EAAA,GAAAY,GAAAA,EAAAe,KAAA3B,EAAA,GAAAU,EAAAV,EAAA,GAAAY,EAAAU,EAAAV,EAAAe,EAAAZ,EAAA,OAAAjC,GAAA4B,EAAA,SAAAc,EAAA,MAAAH,GAAA,EAAAT,CAAA,iBAAA9B,EAAAsB,EAAAuB,GAAA,GAAAP,EAAA,QAAAQ,UAAA,oCAAAP,GAAA,IAAAjB,GAAAqB,EAAArB,EAAAuB,GAAAZ,EAAAX,EAAAa,EAAAU,GAAAlB,EAAAM,EAAA,EAAAnC,EAAAqC,KAAAI,GAAA,CAAArB,IAAAe,EAAAA,EAAA,GAAAA,EAAA,IAAAO,EAAAV,GAAA,GAAAa,EAAAV,EAAAE,IAAAK,EAAAV,EAAAK,EAAAK,EAAAC,EAAAN,GAAA,OAAAG,EAAA,EAAApB,EAAA,IAAAe,IAAAjC,EAAA,QAAA2B,EAAAT,EAAAlB,GAAA,MAAA2B,EAAAA,EAAArB,KAAAY,EAAAiB,IAAA,MAAAW,UAAA,wCAAAnB,EAAAoB,KAAA,OAAApB,EAAAQ,EAAAR,EAAAqB,MAAAf,EAAA,IAAAA,EAAA,YAAAA,IAAAN,EAAAT,EAAA+B,SAAAtB,EAAArB,KAAAY,GAAAe,EAAA,IAAAE,EAAAW,UAAA,oCAAA9C,EAAA,YAAAiC,EAAA,GAAAf,EAAApB,CAAA,UAAA6B,GAAAY,EAAAC,EAAAV,EAAA,GAAAK,EAAAP,EAAAtB,KAAAwB,EAAAU,MAAAE,EAAA,YAAAf,GAAAT,EAAApB,EAAAmC,EAAA,EAAAE,EAAAR,CAAA,SAAAW,EAAA,UAAAU,MAAArB,EAAAoB,KAAAR,EAAA,GAAAX,EAAA5B,EAAAkB,IAAA,GAAAiB,CAAA,KAAAO,EAAA,YAAAR,IAAA,UAAAgB,IAAA,UAAAC,IAAA,CAAAxB,EAAAxB,OAAAiD,eAAA,IAAAnB,EAAA,GAAAH,GAAAH,EAAAA,EAAA,GAAAG,QAAAO,EAAAV,EAAA,GAAAG,EAAA,yBAAAH,GAAAQ,EAAAgB,EAAA/C,UAAA8B,EAAA9B,UAAAD,OAAAiC,OAAAH,GAAA,SAAAK,EAAAxC,GAAA,OAAAK,OAAAkD,eAAAlD,OAAAkD,eAAAvD,EAAAqD,IAAArD,EAAAwD,UAAAH,EAAAd,EAAAvC,EAAAE,EAAA,sBAAAF,EAAAM,UAAAD,OAAAiC,OAAAD,GAAArC,CAAA,QAAAoD,EAAA9C,UAAA+C,EAAAd,EAAAF,EAAA,cAAAgB,GAAAd,EAAAc,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAlB,EAAAc,EAAAnD,EAAA,qBAAAqC,EAAAF,GAAAE,EAAAF,EAAAnC,EAAA,aAAAqC,EAAAF,EAAAL,EAAA,yBAAAO,EAAAF,EAAA,oDAAAqB,EAAA,kBAAAC,EAAAvC,EAAAzB,EAAA6C,EAAA,cAAAD,EAAAvC,EAAA8B,EAAAE,EAAAH,GAAA,IAAAT,EAAAf,OAAAuD,eAAA,IAAAxC,EAAA,gBAAApB,GAAAoB,EAAA,EAAAmB,EAAA,SAAAvC,EAAA8B,EAAAE,EAAAH,GAAA,SAAA3B,EAAA4B,EAAAE,GAAAO,EAAAvC,EAAA8B,EAAA,SAAA9B,GAAA,YAAA6D,QAAA/B,EAAAE,EAAAhC,EAAA,GAAA8B,EAAAV,EAAAA,EAAApB,EAAA8B,EAAA,CAAAoB,MAAAlB,EAAA8B,YAAAjC,EAAAkC,cAAAlC,EAAAmC,UAAAnC,IAAA7B,EAAA8B,GAAAE,GAAA9B,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAqC,EAAAvC,EAAA8B,EAAAE,EAAAH,EAAA,UAAAoC,EAAAjC,EAAAH,EAAA7B,EAAA8B,EAAA5B,EAAA0C,EAAAT,GAAA,QAAAf,EAAAY,EAAAY,GAAAT,GAAAE,EAAAjB,EAAA8B,KAAA,OAAAlB,GAAA,YAAAhC,EAAAgC,EAAA,CAAAZ,EAAA6B,KAAApB,EAAAQ,GAAA6B,QAAAC,QAAA9B,GAAA+B,KAAAtC,EAAA5B,EAAA,UAAAmE,EAAArE,EAAA8B,GAAA,QAAAD,EAAA,EAAAA,EAAAC,EAAAX,OAAAU,IAAA,KAAA3B,EAAA4B,EAAAD,GAAA3B,EAAA4D,WAAA5D,EAAA4D,aAAA,EAAA5D,EAAA6D,cAAA,YAAA7D,IAAAA,EAAA8D,UAAA,GAAA3D,OAAAuD,eAAA5D,EAAAsE,EAAApE,EAAAqE,KAAArE,EAAA,WAAAoE,EAAAzC,GAAA,IAAAT,EAAA,SAAAS,GAAA,aAAA2C,EAAA3C,KAAAA,EAAA,OAAAA,EAAA,IAAA7B,EAAA6B,EAAAE,OAAA0C,aAAA,YAAAzE,EAAA,KAAAoB,EAAApB,EAAAQ,KAAAqB,EAAAC,UAAA,aAAA0C,EAAApD,GAAA,OAAAA,EAAA,UAAA4B,UAAA,uDAAA0B,OAAA7C,EAAA,CAAA8C,CAAA9C,GAAA,gBAAA2C,EAAApD,GAAAA,EAAAA,EAAA,GAUO,IAVPpB,EAAA8B,EAAAD,EAUa+C,EAAiB,kBAV9B5E,EAU8B,SAAA4E,KAV9B,SAAAhC,EAAAZ,GAAA,KAAAY,aAAAZ,GAAA,UAAAgB,UAAA,qCAU8B6B,CAAA,KAAAD,EAAA,EAV9B/C,EAU8B,EAAA0C,IAAA,WAAArB,OAV9BlB,EAU8B0B,IAAA/D,EAG1B,SAAAmF,EACIC,EACAC,EACAC,GAAc,IAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAA3B,IAAAC,EAAA,SAAA2B,GAAA,cAAAA,EAAA9D,EAAA8D,EAAAtD,GAAA,UAETiD,EAAQ,CAAFK,EAAAtD,EAAA,eAAAsD,EAAA1C,EAAA,EACA,CAAE2C,MAAO,uBAAsB,cAAAD,EAAA9D,EAAA,EAAA8D,EAAAtD,EAAA,EAIfwD,MAAM1F,KAAK2F,QAAS,CACvCC,OAAQ,OACRC,QAAS,CACL,cAAiB,UAAFC,OAAYX,GAC3B,eAAgB,yBAChB,UAAW,qBACX,eAAgB,oBAEpBY,KAAMC,KAAKC,UAAU,CACjBf,MAAOA,EACPD,SAAUA,MAEhB,OAZY,IAARG,EAAQI,EAAA3C,GAcAqD,GAAI,CAAFV,EAAAtD,EAAA,eAAAsD,EAAAtD,EAAA,EACYkD,EAASe,OAAM,OAAxB,OAATd,EAASG,EAAA3C,EAAA2C,EAAA1C,EAAA,EACR,CAAE2C,MAAO,aAAFK,OAAeV,EAASgB,OAAM,MAAAN,OAAKT,KAAa,cAAAG,EAAAtD,EAAA,EAG/CkD,EAASiB,OAAM,OAAxB,MAAJf,EAAIE,EAAA3C,GAEDyD,SAAWhB,EAAKgB,QAAQjF,OAAS,GAAC,CAAAmE,EAAAtD,EAAA,eAAAsD,EAAA1C,EAAA,EAChC,CAAEyD,QAASjB,EAAKgB,QAAQ,GAAGE,QAAQD,UAAS,cAAAf,EAAA1C,EAAA,EAE5C,CAAE2C,MAAO,2BAA0B,OAAAD,EAAAtD,EAAA,sBAAAsD,EAAA9D,EAAA,EAAA6D,EAAAC,EAAA3C,EAAA2C,EAAA1C,EAAA,EAIvC,CAAE2C,MAAO,kBAAFK,OAAoBP,EAAEiB,WAAW,cAAAhB,EAAA1C,EAAA,KAAAkC,EAAA,gBAzC7ByB,EAV9B,eAAA1E,EAAA,KAAA7B,EAAAwG,UAAA,WAAAtC,QAAA,SAAApC,EAAA5B,GAAA,IAAA0C,EAAAZ,EAAAyE,MAAA5E,EAAA7B,GAAA,SAAA0G,EAAA1E,GAAAiC,EAAArB,EAAAd,EAAA5B,EAAAwG,EAAAC,EAAA,OAAA3E,EAAA,UAAA2E,EAAA3E,GAAAiC,EAAArB,EAAAd,EAAA5B,EAAAwG,EAAAC,EAAA,QAAA3E,EAAA,CAAA0E,OAAA,MAqDK,SAxCoBE,EAAAC,EAAAC,GAAA,OAAAP,EAAAE,MAAC,KAADD,UAAA,KAbzB3E,GAAAwC,EAAArE,EAAA6B,GAAAxB,OAAAuD,eAAA5D,EAAA,aAAAgE,UAAA,IAAAhE,EAAA,IAAAA,EAAA6B,EAAAG,EAU8BuE,CAGL,CAHK,G,m4CAV9BvG,EAUa4E,EAVb/C,EAWsC,iDAXtCC,EAAAwC,EAAAxC,EAU8B,cAV9B9B,EAAAK,OAAAuD,eAAA5D,EAAA8B,EAAA,CAAAoB,MAAArB,EAAAiC,YAAA,EAAAC,cAAA,EAAAC,UAAA,IAAAhE,EAAA8B,GAAAD,ECeO,IAAMkF,EAAa,kB,sFAAAC,CAAA,SAAAD,K,4FAAAlC,CAAA,KAAAkC,EAAA,MAAAxC,IAAA,QAAArB,MAItB,SAAa+D,GAET,IAOwBC,EAPpBC,EAAaF,EAAM1F,QAAQ,4BAA6B,MAEtD6F,EAAsB,GACxBC,EAAYF,EAEqBG,E,6lBAAAC,CAAvBJ,EAAWK,MAAM,OAEP,IAAxB,IAAAF,EAAAG,MAAAP,EAAAI,EAAAtF,KAAAiB,MAA0B,KAChByE,EADKR,EAAAhE,MACUyE,OACrB,GAAKD,EAAL,CAGA,IAAME,EAAeF,EAAQ3G,cAC7B,GAAIjB,KAAK+H,gBAAgBC,SAASF,GAC9BR,EAASW,KAAK,CAAEC,KAAMJ,EAAcK,KAAM,GAAIC,SAAUR,IACxDL,EAAYA,EAAUG,MAAME,GAASS,KAAK,QAF9C,CAOA,IAGMC,EAHaV,EAAQnG,QAAQ,YAAa,KAGvB6G,MAAM,mCAC/B,GAAIA,EAAO,CACP,IAAMJ,EAAOI,EAAM,GAAGrH,cAEhBkH,EADUG,EAAM,GACDZ,MAAM,KAAKa,IAAI,SAAAzF,GAAC,OAAIA,EAAE+E,MAAM,GAC3CO,EAAWR,EAEXY,EAAWxI,KAAKyI,cAAcP,EAAMC,EAAMC,GAChDd,EAASW,KAAItB,MAAbW,EAAQoB,EAASF,IAEjBjB,EAAYA,EAAUG,MAAMU,GAAUC,KAAK,GAC/C,CAjBA,CARsB,CA0B1B,CAAC,OAAAM,GAAAnB,EAAAtH,EAAAyI,EAAA,SAAAnB,EAAA9E,GAAA,CAGD,MAAO,CAAEyD,KADToB,EAAYA,EAAU9F,QAAQ,WAAY,MAAMoG,OACtBP,SAAAA,EAC9B,GAAC,CAAA7C,IAAA,gBAAArB,MAED,SAA6B8E,EAAcC,EAAgBC,GACvD,OAAQF,GACJ,IAAK,WACD,OAAIC,EAAK9G,QAAU,EACRrB,KAAK4I,cAAcT,EAAMC,GAE7B,CAAC,CAAEF,KAAM,QAASC,KAAM,CAAC,4CAA6CC,SAAAA,IAEjF,IAAK,WACD,OAAID,EAAK9G,QAAU,EACR,CAAC,CACJ6G,KAAM,OACNC,KAAM,CAAC,GAADrC,OAAIqC,EAAK,GAAE,KAAArC,OAAIqC,EAAK,IAAE,GAAArC,OAAOqC,EAAK,GAAE,KAAArC,OAAIqC,EAAK,KACnDC,SAAAA,IAGD,CAAC,CAAEF,KAAM,QAASC,KAAM,CAAC,4CAA6CC,SAAAA,IAEjF,IAAK,YACD,OAAID,EAAK9G,QAAU,EACRrB,KAAK6I,eAAeV,EAAMC,GAE9B,CAAC,CAAEF,KAAM,QAASC,KAAM,CAAC,sCAAuCC,SAAAA,IAI/E,MAAO,CAAC,CAAEF,KAAAA,EAAMC,KAAAA,EAAMC,SAAAA,GAC1B,GAAC,CAAA3D,IAAA,gBAAArB,MAED,SAA6B+E,EAAgBC,GACzC,IAAMU,EAAYC,SAASZ,EAAK,IAC1Ba,EAAYD,SAASZ,EAAK,IAEhC,GAAIc,MAAMH,IAAcG,MAAMD,GAE1B,OADAE,QAAQzD,MAAM,8BAA+B0C,GACtC,CAAC,CAAED,KAAM,QAASC,KAAM,CAAC,uBAAwBC,SAAAA,IAG5D,IACMe,EAAwB,WADZhB,EAAK,IAAM,SAASiB,cACEJ,EAAY,EAAIA,EAClDR,EAAsB,GAE5B,GAAIM,EAAYK,EAEZX,EAASP,KAAK,CACVC,KAAM,cACNC,KAAM,CAAC,GAADrC,OAAIqD,EAAQ,KAAArD,OAAIqD,IACtBf,SAAU,qBAAFtC,OAAuBqD,KAEnCX,EAASP,KAAK,CACVC,KAAM,OACNC,KAAM,CAAC,GAADrC,OAAIgD,EAAS,KAAAhD,OAAIgD,GAAS,GAAAhD,OAAOqD,EAAQ,KAAArD,OAAIqD,IACnDf,SAAU,gBAAFtC,OAAkBgD,EAAS,KAAAhD,OAAIqD,KAE3CX,EAASP,KAAK,CACVC,KAAM,cACNC,KAAM,CAAC,GAADrC,OAAIgD,EAAS,KAAAhD,OAAIgD,IACvBV,SAAU,kBAAFtC,OAAoBgD,SAE7B,CAEH,IAAMO,EAAgBP,EAAY,EAClCN,EAASP,KAAK,CACVC,KAAM,cACNC,KAAM,CAAC,GAADrC,OAAIqD,EAAQ,KAAArD,OAAIqD,IACtBf,SAAU,qBAAFtC,OAAuBqD,KAEnCX,EAASP,KAAK,CACVC,KAAM,OACNC,KAAM,CAAC,GAADrC,OAAIuD,EAAa,KAAAvD,OAAIuD,GAAa,GAAAvD,OAAOqD,EAAQ,KAAArD,OAAIqD,IAC3Df,SAAU,gBAAFtC,OAAkBuD,EAAa,KAAAvD,OAAIqD,KAE/CX,EAASP,KAAK,CACVC,KAAM,cACNC,KAAM,CAAC,GAADrC,OAAIuD,EAAa,KAAAvD,OAAIuD,IAC3BjB,SAAU,kBAAFtC,OAAoBuD,IAEpC,CAEA,OAAOb,CACX,GAAC,CAAA/D,IAAA,iBAAArB,MAED,SAA8B+E,EAAgBC,GAC1C,IAAMkB,EAAOP,SAASZ,EAAK,IACrBoB,EAAOR,SAASZ,EAAK,IAE3B,GAAIc,MAAMK,IAASL,MAAMM,GACrB,MAAO,CAAC,CAAErB,KAAM,QAASC,KAAM,CAAC,uBAAwBC,SAAAA,IAG5D,IAAMoB,EAAUC,KAAKC,IAAIJ,EAAMC,GAAQ,EAEvC,MAAO,CACH,CAAErB,KAAM,cAAeC,KAAM,CAAC,GAADrC,OAAI0D,EAAO,KAAA1D,OAAI0D,IAAYpB,SAAU,0BAClE,CAAEF,KAAM,OAAQC,KAAM,CAAC,GAADrC,OAAIwD,EAAI,KAAAxD,OAAIwD,GAAI,GAAAxD,OAAO0D,EAAO,KAAA1D,OAAI0D,IAAYpB,SAAU,mBAAFtC,OAAqBwD,IACjG,CAAEpB,KAAM,OAAQC,KAAM,CAAC,GAADrC,OAAIyD,EAAI,KAAAzD,OAAIyD,GAAI,GAAAzD,OAAOwD,EAAI,KAAAxD,OAAIwD,IAASlB,SAAU,UAAFtC,OAAYyD,EAAI,KAAAzD,OAAIwD,IAC1F,CAAEpB,KAAM,OAAQC,KAAM,CAAC,GAADrC,OAAI0D,EAAO,KAAA1D,OAAI0D,GAAO,GAAA1D,OAAOyD,EAAI,KAAAzD,OAAIyD,IAASnB,SAAU,eAAFtC,OAAiByD,IAC7F,CAAErB,KAAM,cAAeC,KAAM,CAAC,GAADrC,OAAI0D,EAAO,KAAA1D,OAAI0D,IAAYpB,SAAU,sBAE1E,IAAC,CAlJqB,G,aCf1B,IAAAlI,EAAA6B,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAA/B,EAAA4B,EAAAI,aAAA,yBAAAd,EAAAU,EAAAE,EAAA9B,EAAAkB,GAAA,IAAAe,EAAAH,GAAAA,EAAA1B,qBAAA8B,EAAAJ,EAAAI,EAAAC,EAAAhC,OAAAiC,OAAAH,EAAA7B,WAAA,OAAAiC,EAAAF,EAAA,mBAAAP,EAAAE,EAAA9B,GAAA,IAAAkB,EAAAe,EAAAE,EAAAG,EAAA,EAAAhB,EAAAtB,GAAA,GAAAuC,GAAA,EAAAC,EAAA,CAAAlB,EAAA,EAAAQ,EAAA,EAAAW,EAAA3C,EAAA4C,EAAAC,EAAAL,EAAAK,EAAAC,KAAA9C,EAAA,GAAA6C,EAAA,SAAAhB,EAAAC,GAAA,OAAAV,EAAAS,EAAAM,EAAA,EAAAE,EAAArC,EAAA0C,EAAAV,EAAAF,EAAAc,CAAA,YAAAC,EAAAf,EAAAE,GAAA,IAAAG,EAAAL,EAAAO,EAAAL,EAAAH,EAAA,GAAAY,GAAAD,IAAAtC,GAAA2B,EAAAL,EAAAL,OAAAU,IAAA,KAAA3B,EAAAkB,EAAAI,EAAAK,GAAAgB,EAAAH,EAAAlB,EAAAuB,EAAA3B,EAAA,GAAAU,EAAA,GAAA5B,EAAA6C,IAAAf,KAAAK,EAAAjB,GAAAe,EAAAf,EAAA,OAAAe,EAAA,MAAAf,EAAA,GAAAA,EAAA,GAAApB,GAAAoB,EAAA,IAAAyB,KAAA3C,EAAA4B,EAAA,GAAAe,EAAAzB,EAAA,KAAAe,EAAA,EAAAO,EAAAC,EAAAX,EAAAU,EAAAV,EAAAZ,EAAA,IAAAyB,EAAAE,IAAA7C,EAAA4B,EAAA,GAAAV,EAAA,GAAAY,GAAAA,EAAAe,KAAA3B,EAAA,GAAAU,EAAAV,EAAA,GAAAY,EAAAU,EAAAV,EAAAe,EAAAZ,EAAA,OAAAjC,GAAA4B,EAAA,SAAAc,EAAA,MAAAH,GAAA,EAAAT,CAAA,iBAAA9B,EAAAsB,EAAAuB,GAAA,GAAAP,EAAA,QAAAQ,UAAA,oCAAAP,GAAA,IAAAjB,GAAAqB,EAAArB,EAAAuB,GAAAZ,EAAAX,EAAAa,EAAAU,GAAAlB,EAAAM,EAAA,EAAAnC,EAAAqC,KAAAI,GAAA,CAAArB,IAAAe,EAAAA,EAAA,GAAAA,EAAA,IAAAO,EAAAV,GAAA,GAAAa,EAAAV,EAAAE,IAAAK,EAAAV,EAAAK,EAAAK,EAAAC,EAAAN,GAAA,OAAAG,EAAA,EAAApB,EAAA,IAAAe,IAAAjC,EAAA,QAAA2B,EAAAT,EAAAlB,GAAA,MAAA2B,EAAAA,EAAArB,KAAAY,EAAAiB,IAAA,MAAAW,UAAA,wCAAAnB,EAAAoB,KAAA,OAAApB,EAAAQ,EAAAR,EAAAqB,MAAAf,EAAA,IAAAA,EAAA,YAAAA,IAAAN,EAAAT,EAAA+B,SAAAtB,EAAArB,KAAAY,GAAAe,EAAA,IAAAE,EAAAW,UAAA,oCAAA9C,EAAA,YAAAiC,EAAA,GAAAf,EAAApB,CAAA,UAAA6B,GAAAY,EAAAC,EAAAV,EAAA,GAAAK,EAAAP,EAAAtB,KAAAwB,EAAAU,MAAAE,EAAA,YAAAf,GAAAT,EAAApB,EAAAmC,EAAA,EAAAE,EAAAR,CAAA,SAAAW,EAAA,UAAAU,MAAArB,EAAAoB,KAAAR,EAAA,GAAAX,EAAA5B,EAAAkB,IAAA,GAAAiB,CAAA,KAAAO,EAAA,YAAAR,IAAA,UAAAgB,IAAA,UAAAC,IAAA,CAAAxB,EAAAxB,OAAAiD,eAAA,IAAAnB,EAAA,GAAAH,GAAAH,EAAAA,EAAA,GAAAG,QAAAO,EAAAV,EAAA,GAAAG,EAAA,yBAAAH,GAAAQ,EAAAgB,EAAA/C,UAAA8B,EAAA9B,UAAAD,OAAAiC,OAAAH,GAAA,SAAAK,EAAAxC,GAAA,OAAAK,OAAAkD,eAAAlD,OAAAkD,eAAAvD,EAAAqD,IAAArD,EAAAwD,UAAAH,EAAAd,EAAAvC,EAAAE,EAAA,sBAAAF,EAAAM,UAAAD,OAAAiC,OAAAD,GAAArC,CAAA,QAAAoD,EAAA9C,UAAA+C,EAAAd,EAAAF,EAAA,cAAAgB,GAAAd,EAAAc,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAAlB,EAAAc,EAAAnD,EAAA,qBAAAqC,EAAAF,GAAAE,EAAAF,EAAAnC,EAAA,aAAAqC,EAAAF,EAAAL,EAAA,yBAAAO,EAAAF,EAAA,oDAAAqB,EAAA,kBAAAC,EAAAvC,EAAAzB,EAAA6C,EAAA,cAAAD,EAAAvC,EAAA8B,EAAAE,EAAAH,GAAA,IAAAT,EAAAf,OAAAuD,eAAA,IAAAxC,EAAA,gBAAApB,GAAAoB,EAAA,EAAAmB,EAAA,SAAAvC,EAAA8B,EAAAE,EAAAH,GAAA,SAAA3B,EAAA4B,EAAAE,GAAAO,EAAAvC,EAAA8B,EAAA,SAAA9B,GAAA,YAAA6D,QAAA/B,EAAAE,EAAAhC,EAAA,GAAA8B,EAAAV,EAAAA,EAAApB,EAAA8B,EAAA,CAAAoB,MAAAlB,EAAA8B,YAAAjC,EAAAkC,cAAAlC,EAAAmC,UAAAnC,IAAA7B,EAAA8B,GAAAE,GAAA9B,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAqC,EAAAvC,EAAA8B,EAAAE,EAAAH,EAAA,UAAA2G,EAAA1G,GAAA,gBAAAA,GAAA,GAAA2H,MAAAC,QAAA5H,GAAA,OAAA6H,EAAA7H,EAAA,CAAA8H,CAAA9H,IAAA,SAAAA,GAAA,uBAAAC,QAAA,MAAAD,EAAAC,OAAAE,WAAA,MAAAH,EAAA,qBAAA2H,MAAAI,KAAA/H,EAAA,CAAAgI,CAAAhI,IAAA,SAAAA,EAAAc,GAAA,GAAAd,EAAA,qBAAAA,EAAA,OAAA6H,EAAA7H,EAAAc,GAAA,IAAAf,EAAA,GAAAkI,SAAAvJ,KAAAsB,GAAAkI,MAAA,uBAAAnI,GAAAC,EAAAmI,cAAApI,EAAAC,EAAAmI,YAAAC,MAAA,QAAArI,GAAA,QAAAA,EAAA4H,MAAAI,KAAA/H,GAAA,cAAAD,GAAA,2CAAAR,KAAAQ,GAAA8H,EAAA7H,EAAAc,QAAA,GAAAuH,CAAArI,IAAA,qBAAAkB,UAAA,wIAAAoH,EAAA,UAAAT,EAAA7H,EAAAc,IAAA,MAAAA,GAAAA,EAAAd,EAAAX,UAAAyB,EAAAd,EAAAX,QAAA,QAAAnB,EAAA,EAAAgC,EAAAyH,MAAA7G,GAAA5C,EAAA4C,EAAA5C,IAAAgC,EAAAhC,GAAA8B,EAAA9B,GAAA,OAAAgC,CAAA,UAAAiC,EAAAjC,EAAAH,EAAA7B,EAAA8B,EAAA5B,EAAA0C,EAAAT,GAAA,QAAAf,EAAAY,EAAAY,GAAAT,GAAAE,EAAAjB,EAAA8B,KAAA,OAAAlB,GAAA,YAAAhC,EAAAgC,EAAA,CAAAZ,EAAA6B,KAAApB,EAAAQ,GAAA6B,QAAAC,QAAA9B,GAAA+B,KAAAtC,EAAA5B,EAAA,CAoBA,SAASmK,KAuJT,WAAmB,IAAAC,EACTrD,EAAQrG,SAAS2J,eAAe,cAChCC,EAAU5J,SAAS2J,eAAe,YAGlCE,EAAc7J,SAAS2J,eAAe,gBACtCG,EAAmB9J,SAAS2J,eAAe,sBAC3CI,EAAkB/J,SAAS2J,eAAe,qBAEhDG,SAAAA,EAAkBE,iBAAiB,QAAS,WACpCC,IAlGZ,SAAuBC,GACnB,GAAIC,EAASD,GAAK,CAEd,UADOC,EAASD,GACZE,IAAqBF,EAAI,CAEzB,IAAMG,EAAY5K,OAAO6K,OAAOH,GAAUI,KAAK,SAACvI,EAAGnB,GAAC,OAAKA,EAAE2J,aAAexI,EAAEwI,YAAY,GACxF,KAAIH,EAAU9J,OAAS,GAInB,YADAkK,IAFAL,EAAmBC,EAAU,GAAGH,EAKxC,CACAQ,IACAC,IACAC,GACJ,CACJ,CAkFYC,CAAcZ,GACdA,EAAkB,MAEtBJ,SAAAA,EAAaiB,UAAUC,IAAI,SAC/B,GAEAhB,SAAAA,EAAiBC,iBAAiB,QAAS,WACvCC,EAAkB,KAClBJ,SAAAA,EAAaiB,UAAUC,IAAI,SAC/B,GAGA,IAAMC,EAAUhL,SAAS2J,eAAe,WAClCsB,EAAkBjL,SAAS2J,eAAe,wBAC1CuB,EAAiBlL,SAAS2J,eAAe,uBAE/C,SAASwB,EAAmBC,GACpBA,GACAJ,SAAAA,EAASF,UAAUC,IAAI,aACvBG,SAAAA,EAAgBJ,UAAUO,OAAO,YAEjCL,SAAAA,EAASF,UAAUO,OAAO,aAC1BH,SAAAA,EAAgBJ,UAAUC,IAAI,UAEtC,CAEAE,SAAAA,EAAiBjB,iBAAiB,QAAS,kBAAMmB,GAAmB,EAAK,GACzED,SAAAA,EAAgBlB,iBAAiB,QAAS,kBAAMmB,GAAmB,EAAM,GAEzE,IAAMG,EAAatL,SAAS2J,eAAe,gBAC3C2B,SAAAA,EAAYtB,iBAAiB,QAAS,WAClCS,IAEIpL,OAAOkM,WAAa,KAAKJ,GAAmB,EACpD,GAGA9E,EAAM2D,iBAAiB,QAAS,WAC5B3D,EAAMmF,MAAMC,OAAS,OACrBpF,EAAMmF,MAAMC,OAAS9C,KAAK+C,IAAIrF,EAAMsF,aAAc,KAAO,IAC7D,GAGA,IAAMC,EAAc5L,SAAS2J,eAAe,gBACtCkC,EAAQ7L,SAAS2J,eAAe,kBAChCmC,EAAe9L,SAAS2J,eAAe,qBACvCoC,EAAc/L,SAAS2J,eAAe,gBACtCqC,EAAqBhM,SAAS2J,eAAe,cAC7CsC,EAAcjM,SAAS2J,eAAe,iBAOtCuC,EAAyB,CAC3B,CAAEhC,GAAI,8BAA+BZ,KAAM,4BAC3C,CAAEY,GAAI,4CAA6CZ,KAAM,oCACzD,CAAEY,GAAI,mCAAoCZ,KAAM,+BAChD,CAAEY,GAAI,uCAAwCZ,KAAM,6BACpD,CAAEY,GAAI,4BAA6BZ,KAAM,sBACzC,CAAEY,GAAI,yCAA0CZ,KAAM,yBAGtD6C,EAAkB,GAoBtB,SAASC,IACLC,aAAaC,QAAQ,oBAAqBpH,KAAKC,UAAUgH,IACzDI,IACAC,GACJ,CAEA,SAASD,IACL,IAAME,EAAaV,EAAYzJ,MAC/ByJ,EAAYW,UAAY,GACxBP,EAAOQ,QAAQ,SAAA5N,GACX,IAAM6N,EAAM5M,SAAS6M,cAAc,UACnCD,EAAItK,MAAQvD,EAAEmL,GACd0C,EAAIE,YAAc/N,EAAEuK,KACpByC,EAAYgB,YAAYH,EAC5B,GACIH,GAAcN,EAAOa,KAAK,SAAAjO,GAAC,OAAIA,EAAEmL,KAAOuC,CAAU,GAClDV,EAAYzJ,MAAQmK,EACbN,EAAO5L,OAAS,IACvBwL,EAAYzJ,MAAQ6J,EAAO,GAAGjC,GAEtC,CAEA,SAASsC,IACAR,IACLA,EAAmBU,UAAY,GAE/BP,EAAOQ,QAAQ,SAAC5N,EAAGkO,GACf,IAAMC,EAAOlN,SAAS6M,cAAc,OACpCK,EAAKC,UAAY,aACjBD,EAAKR,UAAY,4FAAH1H,OAEqBjG,EAAEuK,KAAI,wDAAAtE,OACRjG,EAAEmL,GAAE,kGAAAlF,OAEciI,EAAK,+CAExDjB,EAAmBe,YAAYG,EACnC,GACJ,CAGAlB,SAAAA,EAAoBhC,iBAAiB,QAAS,SAAC5K,GAC3C,IACMgO,EADShO,EAAEiO,OACEC,QAAQ,qBAC3B,GAAIF,EAAK,CACL,IAAMG,EAAMtF,SAASmF,EAAII,aAAa,eAAiB,MACvD,GAAID,GAAO,EAGP,IACIpB,EAAOsB,OAAOF,EAAK,GACnBnB,GACJ,CAAE,MAAOvE,GACLO,QAAQzD,MAAM,gBAAiBkD,EACnC,CAER,CACJ,GAzEA,WACI,IAAM6F,EAASrB,aAAasB,QAAQ,qBACpC,GAAID,EACA,IACIvB,EAASjH,KAAK0I,MAAMF,EACxB,CAAE,MAAOtO,GACLgJ,QAAQzD,MAAM,yBAA0BvF,GACxC+M,EAAS,GAAHnH,OAAOkH,EACjB,MAEAC,EAAS,GAAHnH,OAAOkH,GAEjBK,IACAC,GACJ,CA8DAqB,GAGA5B,SAAAA,EAAajC,iBAAiB,QAAS,WACnC,IAAM8D,EAAU9N,SAAS2J,eAAe,gBAClCoE,EAAY/N,SAAS2J,eAAe,kBAEpCO,EAAK4D,EAAQxL,MAAMyE,OACnBuC,EAAOyE,EAAUzL,MAAMyE,OAExBmD,GAAOZ,GAKZ6C,EAAOhF,KAAK,CAAE+C,GAAAA,EAAIZ,KAAAA,IAClB8C,IAEA0B,EAAQxL,MAAQ,GAChByL,EAAUzL,MAAQ,IARd0L,MAAM,8CASd,GAGA,IAAMC,EAAW5B,aAAasB,QAAQ,kBAClCM,IACCjO,SAAS2J,eAAe,iBAAsCrH,MAAQ2L,GAI3ErC,SAAAA,EAAa5B,iBAAiB,QAAS,WACnC6B,SAAAA,EAAOf,UAAUO,OAAO,UAExBmB,GACJ,GAE6C,QAA7C9C,EAAA1J,SAAS2J,eAAe,6BAAqB,IAAAD,GAA7CA,EAA+CM,iBAAiB,QAAS,kBAAM6B,aAAK,EAALA,EAAOf,UAAUC,IAAI,SAAS,GAE7Ge,SAAAA,EAAc9B,iBAAiB,QAAS,WACpC,IAAMrG,EAAO3D,SAAS2J,eAAe,iBAAsCrH,MAAMyE,OAC7EpD,IACA0I,aAAaC,QAAQ,iBAAkB3I,GACvCuK,EAAc,iBAAkB,OAKpC9B,IACAP,SAAAA,EAAOf,UAAUC,IAAI,SACzB,GAGA,IAAIoD,EAAuD,KACvDC,EAAoD,KAkBxD,SAASC,IACL,OAAO,IAAI/K,QAAQ,SAACC,GAChB4K,EAAwB5K,EACxB+K,OAAOC,QAAQC,GAAGC,cAAc,eAEhCC,WAAW,WACHP,IACA/F,QAAQuG,KAAK,6BACbR,EAAsB,CAAC,GACvBA,EAAwB,KAEhC,EAAG,IACP,EACJ,CAEA,SAASS,EAAwBpI,GAC7B,OAAO,IAAIlD,QAAQ,SAACC,GAChB6K,EAAqB7K,EACrB,IAAMsL,EAAU3J,KAAKC,UAAU,CAAEiC,KAAM,UAAWZ,SAAUA,IAC5D8H,OAAOC,QAAQC,GAAGC,cAAcI,GAG/BH,WAAW,WACJN,IACAA,EAAmB,CAAEU,SAAS,EAAOC,OAAQ,CAAC,aAC9CX,EAAqB,KAE7B,EAAG,IACP,EACJ,CAIA,SAASY,EAAiBxI,GACtB,IAAMuI,EAAmB,GAqCzB,OAnCAvI,EAASmG,QAAQ,SAACsC,EAAK1B,GAEF,UAAb0B,EAAI7H,MAMS,gBAAb6H,EAAI7H,MAAuC,gBAAb6H,EAAI7H,MAC7B6H,EAAI5H,KAAK,IAAO,YAAY5G,KAAKwO,EAAI5H,KAAK,KAC3C0H,EAAO5H,KAAK,WAADnC,OAAYuI,EAAM,EAAC,MAAAvI,OAAKiK,EAAI7H,KAAI,iCAAApC,OAAgCiK,EAAI5H,KAAK,IAAM,UAKjF,SAAb4H,EAAI7H,MAAmB6H,EAAI5H,KAAK9G,OAAS,GACzCwO,EAAO5H,KAAK,WAADnC,OAAYuI,EAAM,EAAC,gDAIhB,cAAb0B,EAAI7H,MAAqC,gBAAb6H,EAAI7H,OAA2B6H,EAAI5H,KAAK9G,OAAS,GAC9EwO,EAAO5H,KAAK,WAADnC,OAAYuI,EAAM,EAAC,MAAAvI,OAAKiK,EAAI7H,KAAI,kCAI3C6H,EAAI7H,KAAK8H,WAAW,YAAcD,EAAI5H,KAAK9G,OAAS,GACpDwO,EAAO5H,KAAK,WAADnC,OAAYuI,EAAM,EAAC,MAAAvI,OAAKiK,EAAI7H,KAAI,kCAI9B,SAAb6H,EAAI7H,MAAmB6H,EAAI5H,KAAK9G,OAAS,GACzCwO,EAAO5H,KAAK,WAADnC,OAAYuI,EAAM,EAAC,sDA5B9BwB,EAAO5H,KAAK,WAADnC,OAAYuI,EAAM,EAAC,MAAAvI,OAAKiK,EAAI5H,KAAK,IAAM,eAAc,OAAArC,OAAMiK,EAAI3H,UA8BlF,GAEO,CAAE6H,MAAyB,IAAlBJ,EAAOxO,OAAcwO,OAAAA,EACzC,CAEA,SACeK,IAAW,OAAAC,EAAAxJ,MAAC,KAADD,UAAA,UAAAyJ,IAvd9B,IAAAjO,EAyuBK,OAzuBLA,EAud8B0B,IAAA/D,EAA1B,SAAAmF,IAAA,IAAAmB,EAAAhB,EAAAiL,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA3L,EAAA4L,EAAAC,EAAAC,EAAA7L,EAAA8L,EAAA5L,EAAA6L,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAhM,EAAAiM,EAAA,OAAA5N,IAAAC,EAAA,SAAA2B,GAAA,cAAAA,EAAA9D,EAAA8D,EAAAtD,GAAA,OAKmC,GAJ1BgJ,GAAqBD,EAASC,IAC/BK,IAGEpF,EAAOgB,EAAM/D,MAAMyE,OACd,CAAFrC,EAAAtD,EAAA,eAAAsD,EAAA1C,EAAA,UAE4C,GAA/CqC,EAASgI,aAAasB,QAAQ,kBACvB,CAAFjJ,EAAAtD,EAAA,QAEsE,OAD7EyK,SAAAA,EAAOf,UAAUO,OAAO,UACxB6C,EAAc,wDAAyD,MAAMxJ,EAAA1C,EAAA,UAe3D,GAXhBsN,EAAetP,SAAS2J,eAAe,gBAAqCgH,QAElFzC,EAAc7I,EAAM,QACpBgB,EAAM/D,MAAQ,GAEd+D,EAAMmF,MAAMC,OAAS,OAGf8D,EAAarB,EAAc,cAAe,MAAM,GAGlDsB,EAAc,MACdF,EAAa,CAAF5K,EAAAtD,EAAA,eAAAsD,EAAA9D,EAAA,EAAA8D,EAAAtD,EAAA,EAEaiN,IAAsB,OAA1CmB,EAAW9K,EAAA3C,EAAA2C,EAAAtD,EAAG,EAAH,aAAAsD,EAAA9D,EAAG,EAAH6D,EAAAC,EAAA3C,EAEXqG,QAAQzD,MAAM,yBAAwBF,GAAK,OA+Kd,OA1CjCgL,EAhIiB,09IAkIjBD,GAAeA,EAAYoB,YAC3BnB,GAAc,sCAAJzK,OAA0CwK,EAAYoB,UAAS,iBAAA5L,OAAgBwK,EAAYqB,QAAO,2BAAA7L,OAA0BE,KAAKC,UAAUqK,EAAYlF,SAC7JkF,EAAYsB,YAENpB,EAAeF,EAAYsB,UAAUD,QACrClB,EAAsBD,EAAaxI,SAAS,KAC5CwI,EAAa9I,MAAM,KAAK,GACxB8I,EAGAE,EAAgBD,EAAoBnI,MAAM,gBAC1CqI,EAAWD,EAAgB3H,SAAS2H,EAAc,IAAM,EAExDE,EAAmBN,EAAYsB,UAAUxG,OAAmB7C,IAAI,SAACsJ,EAAKxD,GAAG,aAAAvI,OACpE6K,EAAWtC,EAAG,MAAAvI,OAAKE,KAAKC,UAAU4L,GAAI,GAC/CxJ,KAAK,MAEPkI,GAAc,mCAAJzK,OAAuCwK,EAAYsB,UAAUD,QAAO,QAAA7L,OAAO8K,KAMvF3L,EAAyB,CAAC,CAAE6M,KAAM,SAAUvL,QAASgK,IAGrDM,EAAiB5F,EAASC,GAAmBjG,SAG/C6L,EAAkBD,EAClBA,EAAexP,OAAS,KACxByP,EAAkBD,EAAe3G,MAAM2G,EAAexP,OAAS,KAEnE4D,EAASgD,KAAItB,MAAb1B,EAAQyD,EAASoI,IAGXC,EAA6B,CAAEe,KAAM,OAAQvL,QAASJ,GAC5DlB,EAASgD,KAAK8I,GAER7L,EAAQ2H,EAAYzJ,MACpB4N,EAAY9F,EAAmB1F,EAAA9D,EAAA,EAAA8D,EAAAtD,EAAA,EAIV4C,EAAkBiN,SAAS9M,EAAUC,EAAOC,GAAO,OAChD,GADpBC,EAAQI,EAAA3C,EACdmP,EAAc3B,IAEVjL,EAASK,MAAO,CAAFD,EAAAtD,EAAA,QACkC,OAAhD8M,EAAc,UAADlJ,OAAWV,EAASK,OAAS,MAAMD,EAAA1C,EAAA,UAkCpD,GA7BAmI,EAAS+F,GAAW/L,SAASgD,KAAK8I,GAG9B9F,EAAS+F,GAAW/L,SAAS5D,QAAU,GAAmC,aAA9B4J,EAAS+F,GAAWiB,QAC/DhH,EAAS+F,GAAWiB,MAAQ9L,EAAK+L,UAAU,EAAG,KAAO/L,EAAK9E,OAAS,GAAK,MAAQ,KAErF4J,EAAS+F,GAAW1F,aAAe6G,KAAKC,MACxC1G,IAGMuF,EAAa7L,EAASmB,SAAW,GAGjC2K,EAAoB,CAAEY,KAAM,YAAavL,QAAS0K,GACxDhG,EAAS+F,GAAW/L,SAASgD,KAAKiJ,GAClC1F,KAEM2F,EAASlK,EAAcyH,MAAMuC,IAGxB9K,MACP6I,EAAcmC,EAAOhL,KAAM,MAI1BgL,EAAOhL,MAAmC,IAA3BgL,EAAO7J,SAASjG,QAC/B2N,EAAciC,GAAc,mBAAoB,QAIjDE,EAAO7J,SAASjG,OAAS,GAAC,CAAAmE,EAAAtD,EAAA,SAC0B,IAA9CkP,EAAatB,EAAiBqB,EAAO7J,WAC3B2I,MAAO,CAAFzK,EAAAtD,EAAA,SAC6D,OAA9E8M,EAAc,0BAADlJ,OAA2BsL,EAAWvB,OAAOxH,KAAK,OAAS,MAAM7C,EAAA1C,EAAA,WAIW,OAAvFuO,EAAYrC,EAAc,aAADlJ,OAAcqL,EAAO7J,SAASjG,OAAM,eAAe,MAAM,GAAKmE,EAAAtD,EAAA,GAExEwN,EAAwByB,EAAO7J,UAAS,QAAvDgK,EAAM9L,EAAA3C,EAEZmP,EAAcX,GAEVC,EAAO1B,SACD2B,EAAaJ,EAAO7J,SAASiB,IAAI,SAAAlG,GAAC,OAAIA,EAAE+F,QAAQ,GAAEC,KAAK,MAC7D2G,EAAc,gBAADlJ,OAAiByL,GAAc,OAE5CvC,EAAc,cAADlJ,OAAewL,EAAOzB,OAAOxH,KAAK,OAAS,MAC3D,QAAA7C,EAAAtD,EAAA,iBAAAsD,EAAA9D,EAAA,GAAA8P,EAAAhM,EAAA3C,EAILmP,EAAc3B,GACdrB,EAAc,iBAADlJ,OAAA0L,GAAyB,MAAM,eAAAhM,EAAA1C,EAAA,KAAAkC,EAAA,uBAhR1BmL,EAvd9B,eAAApO,EAAA,KAAA7B,EAAAwG,UAAA,WAAAtC,QAAA,SAAApC,EAAA5B,GAAA,IAAA0C,EAAAZ,EAAAyE,MAAA5E,EAAA7B,GAAA,SAAA0G,EAAA1E,GAAAiC,EAAArB,EAAAd,EAAA5B,EAAAwG,EAAAC,EAAA,OAAA3E,EAAA,UAAA2E,EAAA3E,GAAAiC,EAAArB,EAAAd,EAAA5B,EAAAwG,EAAAC,EAAA,QAAA3E,EAAA,CAAA0E,OAAA,MAyuBKuJ,EAAAxJ,MAAA,KAAAD,UAAA,CA7WD0I,OAAOC,QAAQC,GAAG+C,gBAAgBjD,OAAOkD,UAAUC,4BAA6B,SAACC,GAC7EtJ,QAAQuJ,IAAI,uBAAwBD,EAAIhM,SACxC,IACI,IAAMkM,EAAM1M,KAAK0I,MAAM8D,EAAIhM,SACV,YAAbkM,EAAIxK,MAAsB+G,GAC1BA,EAAsByD,EAAIpN,MAC1B2J,EAAwB,MACJ,qBAAbyD,EAAIxK,MAA+BgH,IAC1CA,EAAmBwD,EAAIpN,MACvB4J,EAAqB,KAE7B,CAAE,MAAOhP,GACLgJ,QAAQzD,MAAM,iCAAkCvF,EACpD,CACJ,GAiWAwK,SAAAA,EAASI,iBAAiB,QAASoF,GAEnC/I,EAAM2D,iBAAiB,UAAW,SAAC5K,GACjB,UAAVA,EAAEuE,KAAoBvE,EAAEyS,WACxBzS,EAAE0S,iBACF1C,IAGR,EACJ,CA/tBI2C,GAwBJ,WACI,IAAMC,EAAiB3F,aAAasB,QAAQ,iBACtCsE,EAAkB5F,aAAasB,QAAQ,sBAE7C,GAAIqE,EACA,IACI7H,EAAWjF,KAAK0I,MAAMoE,EAC1B,CAAE,MAAO5S,GACLgJ,QAAQzD,MAAM,2BAA4BvF,GAC1C+K,EAAW,CAAC,CAChB,CAGA8H,GAAmB9H,EAAS8H,GAC5B7H,EAAmB6H,EAGnBxH,IAGJE,IACAC,GACJ,CA7CIsH,EACJ,E,mHDPIC,CADShM,EAAa,kBAEW,CAAC,OAAQ,sBCT9CmI,OAAO8D,QAAQ,SAACC,GACRA,EAAKC,OAAShE,OAAOiE,SAASC,QAC9BpK,QAAQuJ,IAAI,sBAEgB,YAAxB3R,SAASyS,WACTzS,SAASgK,iBAAiB,mBAAoBP,GAE9CA,IAGZ,GAeA,IAAIU,EAAwC,CAAC,EACzCC,EAAkC,KAMtC,SAASM,IACL2B,aAAaC,QAAQ,gBAAiBpH,KAAKC,UAAUgF,IACrDkC,aAAaC,QAAQ,qBAAsBlC,GAAoB,GACnE,CA0BA,SAASK,IACL,IAAMP,EAjCCmH,KAAKC,MAAMnI,SAAS,IAAMR,KAAK+J,SAASvJ,SAAS,IAAIC,MAAM,GAkClEe,EAASD,GAAM,CACXA,GAAAA,EACAiH,MAAO,WACPhN,SAAU,CAAC,CAAE6M,KAAM,YAAavL,QAAS,wCACzC+E,aAAc6G,KAAKC,OAEvBlH,EAAmBF,EACnBQ,IACAC,IACAC,GACJ,CA8BA,SAASD,IACL,IAAMgI,EAAY3S,SAAS2J,eAAe,gBACrCgJ,GAAcvI,GAAqBD,EAASC,KAEjDuI,EAAUjG,UAAY,GAELvC,EAASC,GAAkBjG,SACnCwI,QAAQ,SAAAiF,GACb1D,EAAc0D,EAAInM,QAASmM,EAAIZ,KACnC,GACJ,CAGA,IAAI/G,EAAiC,KAErC,SAASW,IACL,IAAMgI,EAAS5S,SAAS2J,eAAe,aAClCiJ,IAELA,EAAOlG,UAAY,GAEIjN,OAAO6K,OAAOH,GAAUI,KAAK,SAACvI,EAAGnB,GAAC,OAAKA,EAAE2J,aAAexI,EAAEwI,YAAY,GAE9EmC,QAAQ,SAAAkG,GACnB,IAAM3F,EAAOlN,SAAS6M,cAAc,OACpCK,EAAKC,UAAY,aAAHnI,OAAgB6N,EAAQ3I,KAAOE,EAAmB,SAAW,IAC3E8C,EAAK4F,QAAU,kBAnCA5I,EAmCoB2I,EAAQ3I,QAlC3CC,EAASD,KACTE,EAAmBF,EACnBQ,IACAC,IACAC,MALR,IAAuBV,CAmC+B,EAE9C,IAAMiH,EAAQnR,SAAS6M,cAAc,QACrCsE,EAAMhE,UAAY,kBAClBgE,EAAMrE,YAAc+F,EAAQ1B,MAG5B,IAAM4B,EAAU/S,SAAS6M,cAAc,UACvCkG,EAAQ3L,KAAO,SACf2L,EAAQ5F,UAAY,qBACpB4F,EAAQrG,UAAY,IAEpBqG,EAAQ/I,iBAAiB,QAAS,SAAC5K,GAC/BA,EAAE4T,kBACF5K,QAAQuJ,IAAI,mCAAoCkB,EAAQ3I,IAGxDD,EAAkB4I,EAAQ3I,GAC1B,IAAML,EAAc7J,SAAS2J,eAAe,gBACxCE,GACAA,EAAYiB,UAAUO,OAAO,UAE7BxB,EAAY2B,MAAMyH,QAAU,QAE5B7K,QAAQzD,MAAM,gCAEtB,GAEAuI,EAAKH,YAAYoE,GACjBjE,EAAKH,YAAYgG,GACjBH,EAAO7F,YAAYG,EACvB,GACJ,CA6kBA,SAASgB,EAAc7I,EAAc6N,GAA6D,IAAtCC,EAAoBvN,UAAArF,OAAA,QAAA5B,IAAAiH,UAAA,IAAAA,UAAA,GACtE+M,EAAY3S,SAAS2J,eAAe,gBACpCyJ,EAASpT,SAAS6M,cAAc,OAChC3C,EAAK,OAAHlF,OAAUqM,KAAKC,MAAK,KAAAtM,OAAI2D,KAAK+J,UACrCU,EAAOlJ,GAAKA,EACZkJ,EAAOjG,UAAY,mBAAHnI,OAAsBkO,GAAMlO,OAAGmO,EAAc,aAAe,IAE5E,IAAME,EAASrT,SAAS6M,cAAc,OACtCwG,EAAOlG,UAAY,SACnBkG,EAAOvG,YAAyB,OAAXoG,EAAkB,KAAO,KAE9C,IAAMzN,EAAUzF,SAAS6M,cAAc,OAGvC,GAFApH,EAAQ0H,UAAY,kBAEL,OAAX+F,EAAiB,CAGjB,IAAMI,EAAW,IAAIC,OAAOC,SAC5BF,EAASG,KAAO,iBAAM,EAAE,EAExBhO,EAAQiH,UAAY6G,OAAO3F,MAAMvI,EAAM,CAAEiO,SAAAA,GAC7C,MACI7N,EAAQiO,UAAYrO,EAWxB,OARA+N,EAAOrG,YAAYsG,GACnBD,EAAOrG,YAAYtH,GAEfkN,IACAA,EAAU5F,YAAYqG,GACtBT,EAAUgB,UAAYhB,EAAUhH,cAG7BzB,CACX,CAEA,SAASgH,EAAchH,GACnB,IAAM0J,EAAK5T,SAAS2J,eAAeO,GAC/B0J,GAAIA,EAAGvI,QACf,C,IC7xBiC,IAAIwI,IAAI,a","sources":["webpack://ai-excel-assistant/webpack/bootstrap","webpack://ai-excel-assistant/webpack/runtime/global","webpack://ai-excel-assistant/webpack/runtime/hasOwnProperty shorthand","webpack://ai-excel-assistant/webpack/runtime/publicPath","webpack://ai-excel-assistant/webpack/runtime/jsonp chunk loading","webpack://ai-excel-assistant/./src/services/OpenRouterService.ts","webpack://ai-excel-assistant/./src/services/CommandParser.ts","webpack://ai-excel-assistant/./src/dialog/dialog.ts","webpack://ai-excel-assistant/./src/dialog/dialog.html"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = (typeof document !== 'undefined' && document.baseURI) || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t907: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","\r\nexport interface LLMMessage {\r\n    role: \"system\" | \"user\" | \"assistant\";\r\n    content: string;\r\n}\r\n\r\nexport interface CompletionResponse {\r\n    content?: string;\r\n    error?: string;\r\n}\r\n\r\nexport class OpenRouterService {\r\n    private static readonly API_URL = \"https://openrouter.ai/api/v1/chat/completions\";\r\n\r\n    static async complete(\r\n        messages: LLMMessage[],\r\n        model: string,\r\n        apiKey: string\r\n    ): Promise<CompletionResponse> {\r\n        if (!apiKey) {\r\n            return { error: \"API Key is missing\" };\r\n        }\r\n\r\n        try {\r\n            const response = await fetch(this.API_URL, {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Authorization\": `Bearer ${apiKey}`,\r\n                    \"HTTP-Referer\": \"https://localhost:3000\", // Required by OpenRouter\r\n                    \"X-Title\": \"AI Excel Assistant\", // Optional\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n                body: JSON.stringify({\r\n                    model: model,\r\n                    messages: messages\r\n                })\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorText = await response.text();\r\n                return { error: `API Error ${response.status}: ${errorText}` };\r\n            }\r\n\r\n            const data = await response.json();\r\n            \r\n            if (data.choices && data.choices.length > 0) {\r\n                return { content: data.choices[0].message.content };\r\n            } else {\r\n                return { error: \"No response from model\" };\r\n            }\r\n\r\n        } catch (e) {\r\n            return { error: `Network error: ${e.message}` };\r\n        }\r\n    }\r\n}\r\n","/*\r\n * CommandParser.ts\r\n * Parses DSL commands from LLM output\r\n */\r\n\r\nexport interface Command {\r\n    type: string;\r\n    args: string[];\r\n    original: string;\r\n}\r\n\r\nexport interface ParseResult {\r\n    text: string;\r\n    commands: Command[];\r\n}\r\n\r\nexport class CommandParser {\r\n    // Commands that require no arguments\r\n    private static NO_ARG_COMMANDS = [\"UNDO\", \"DELETE_ALL_CHARTS\"];\r\n\r\n    static parse(input: string): ParseResult {\r\n        // 1. Remove markdown code blocks but keep content\r\n        let cleanInput = input.replace(/```[\\w]*\\n?([\\s\\S]*?)```/g, '$1');\r\n        \r\n        const commands: Command[] = [];\r\n        let cleanText = cleanInput;\r\n\r\n        const lines = cleanInput.split('\\n');\r\n        \r\n        for (const line of lines) {\r\n            const trimmed = line.trim();\r\n            if (!trimmed) continue;\r\n            \r\n            // Check for no-arg commands first (case-insensitive)\r\n            const upperTrimmed = trimmed.toUpperCase();\r\n            if (this.NO_ARG_COMMANDS.includes(upperTrimmed)) {\r\n                commands.push({ type: upperTrimmed, args: [], original: trimmed });\r\n                cleanText = cleanText.split(trimmed).join(\"\"); \r\n                continue;\r\n            }\r\n\r\n            // Normalize spaces around pipes\r\n            const normalized = trimmed.replace(/\\s*\\|\\s*/g, '|');\r\n\r\n            // Check for piped commands: COMMAND|arg1|arg2... (case-insensitive type)\r\n            const match = normalized.match(/^([A-Za-z][A-Za-z_0-9]+)\\|(.*)$/);\r\n            if (match) {\r\n                const type = match[1].toUpperCase();\r\n                const argsStr = match[2];\r\n                const args = argsStr.split('|').map(a => a.trim());\r\n                const original = trimmed;\r\n\r\n                const expanded = this.expandCommand(type, args, original);\r\n                commands.push(...expanded);\r\n                \r\n                cleanText = cleanText.split(original).join(\"\"); \r\n            }\r\n        }\r\n\r\n        cleanText = cleanText.replace(/\\n\\s*\\n/g, \"\\n\").trim();\r\n        return { text: cleanText, commands };\r\n    }\r\n\r\n    private static expandCommand(type: string, args: string[], original: string): Command[] {\r\n        switch (type) {\r\n            case \"MOVE_ROW\":\r\n                if (args.length >= 2) {\r\n                    return this.expandMoveRow(args, original);\r\n                }\r\n                return [{ type: \"ERROR\", args: [\"MOVE_ROW requires source and target rows\"], original }];\r\n                \r\n            case \"COPY_ROW\":\r\n                if (args.length >= 2) {\r\n                    return [{\r\n                        type: \"COPY\",\r\n                        args: [`${args[0]}:${args[0]}`, `${args[1]}:${args[1]}`],\r\n                        original\r\n                    }];\r\n                }\r\n                return [{ type: \"ERROR\", args: [\"COPY_ROW requires source and target rows\"], original }];\r\n                \r\n            case \"SWAP_ROWS\":\r\n                if (args.length >= 2) {\r\n                    return this.expandSwapRows(args, original);\r\n                }\r\n                return [{ type: \"ERROR\", args: [\"SWAP_ROWS requires two row numbers\"], original }];\r\n        }\r\n        \r\n        // Default: return as-is\r\n        return [{ type, args, original }];\r\n    }\r\n\r\n    private static expandMoveRow(args: string[], original: string): Command[] {\r\n        const sourceRow = parseInt(args[0]);\r\n        const targetRow = parseInt(args[1]);\r\n        \r\n        if (isNaN(sourceRow) || isNaN(targetRow)) {\r\n            console.error(\"Invalid MOVE_ROW arguments:\", args);\r\n            return [{ type: \"ERROR\", args: [\"Invalid row numbers\"], original }];\r\n        }\r\n        \r\n        const position = (args[2] || \"after\").toLowerCase();\r\n        const insertAt = position === \"after\" ? targetRow + 1 : targetRow;\r\n        const expanded: Command[] = [];\r\n        \r\n        if (sourceRow < insertAt) {\r\n            // Moving down\r\n            expanded.push({ \r\n                type: \"INSERT_ROWS\", \r\n                args: [`${insertAt}:${insertAt}`], \r\n                original: `[MOVE‚Üì] Insert at ${insertAt}` \r\n            });\r\n            expanded.push({ \r\n                type: \"COPY\", \r\n                args: [`${sourceRow}:${sourceRow}`, `${insertAt}:${insertAt}`], \r\n                original: `[MOVE‚Üì] Copy ${sourceRow}‚Üí${insertAt}` \r\n            });\r\n            expanded.push({ \r\n                type: \"DELETE_ROWS\", \r\n                args: [`${sourceRow}:${sourceRow}`], \r\n                original: `[MOVE‚Üì] Delete ${sourceRow}` \r\n            });\r\n        } else {\r\n            // Moving up\r\n            const shiftedSource = sourceRow + 1;\r\n            expanded.push({ \r\n                type: \"INSERT_ROWS\", \r\n                args: [`${insertAt}:${insertAt}`], \r\n                original: `[MOVE‚Üë] Insert at ${insertAt}` \r\n            });\r\n            expanded.push({ \r\n                type: \"COPY\", \r\n                args: [`${shiftedSource}:${shiftedSource}`, `${insertAt}:${insertAt}`], \r\n                original: `[MOVE‚Üë] Copy ${shiftedSource}‚Üí${insertAt}` \r\n            });\r\n            expanded.push({ \r\n                type: \"DELETE_ROWS\", \r\n                args: [`${shiftedSource}:${shiftedSource}`], \r\n                original: `[MOVE‚Üë] Delete ${shiftedSource}` \r\n            });\r\n        }\r\n        \r\n        return expanded;\r\n    }\r\n\r\n    private static expandSwapRows(args: string[], original: string): Command[] {\r\n        const row1 = parseInt(args[0]);\r\n        const row2 = parseInt(args[1]);\r\n        \r\n        if (isNaN(row1) || isNaN(row2)) {\r\n            return [{ type: \"ERROR\", args: [\"Invalid row numbers\"], original }];\r\n        }\r\n        \r\n        const tempRow = Math.max(row1, row2) + 1;\r\n        \r\n        return [\r\n            { type: \"INSERT_ROWS\", args: [`${tempRow}:${tempRow}`], original: `[SWAP] Create temp row` },\r\n            { type: \"COPY\", args: [`${row1}:${row1}`, `${tempRow}:${tempRow}`], original: `[SWAP] Save row ${row1}` },\r\n            { type: \"COPY\", args: [`${row2}:${row2}`, `${row1}:${row1}`], original: `[SWAP] ${row2}‚Üí${row1}` },\r\n            { type: \"COPY\", args: [`${tempRow}:${tempRow}`, `${row2}:${row2}`], original: `[SWAP] temp‚Üí${row2}` },\r\n            { type: \"DELETE_ROWS\", args: [`${tempRow}:${tempRow}`], original: `[SWAP] Delete temp` }\r\n        ];\r\n    }\r\n}\r\n","/*\r\n * AI Assistant Dialog Logic\r\n */\r\n\r\n/* global document, Office, console, marked */\r\n\r\nimport { OpenRouterService, LLMMessage } from \"../services/OpenRouterService\";\r\nimport { CommandParser } from \"../services/CommandParser\";\r\n\r\nOffice.onReady((info) => {\r\n    if (info.host === Office.HostType.Excel) {\r\n        console.log(\"Dialog initialized\");\r\n        // Ensure DOM is ready\r\n        if (document.readyState === \"loading\") {\r\n            document.addEventListener(\"DOMContentLoaded\", initApp);\r\n        } else {\r\n            initApp();\r\n        }\r\n    }\r\n});\r\n\r\nfunction initApp() {\r\n    setupUI();\r\n    loadSessions();\r\n}\r\n\r\n// Session Management\r\ninterface ChatSession {\r\n    id: string;\r\n    title: string;\r\n    messages: LLMMessage[];\r\n    lastModified: number;\r\n}\r\n\r\nlet sessions: Record<string, ChatSession> = {};\r\nlet currentSessionId: string | null = null;\r\n\r\nfunction generateId(): string {\r\n    return Date.now().toString(36) + Math.random().toString(36).slice(2);\r\n}\r\n\r\nfunction saveSessions() {\r\n    localStorage.setItem(\"chat_sessions\", JSON.stringify(sessions));\r\n    localStorage.setItem(\"current_session_id\", currentSessionId || \"\");\r\n}\r\n\r\nfunction loadSessions() {\r\n    const storedSessions = localStorage.getItem(\"chat_sessions\");\r\n    const storedCurrentId = localStorage.getItem(\"current_session_id\");\r\n\r\n    if (storedSessions) {\r\n        try {\r\n            sessions = JSON.parse(storedSessions);\r\n        } catch (e) {\r\n            console.error(\"Failed to parse sessions\", e);\r\n            sessions = {};\r\n        }\r\n    }\r\n\r\n    if (storedCurrentId && sessions[storedCurrentId]) {\r\n        currentSessionId = storedCurrentId;\r\n    } else {\r\n        // Create default if empty\r\n        createNewSession();\r\n    }\r\n    \r\n    renderCurrentSession();\r\n    renderChatList();\r\n}\r\n\r\nfunction createNewSession() {\r\n    const id = generateId();\r\n    sessions[id] = {\r\n        id,\r\n        title: \"New Chat\",\r\n        messages: [{ role: \"assistant\", content: \"–ü—Ä–∏–≤–µ—Ç! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å Excel.\" }],\r\n        lastModified: Date.now()\r\n    };\r\n    currentSessionId = id;\r\n    saveSessions();\r\n    renderCurrentSession();\r\n    renderChatList();\r\n}\r\n\r\nfunction deleteSession(id: string) {\r\n    if (sessions[id]) {\r\n        delete sessions[id];\r\n        if (currentSessionId === id) {\r\n            // Switch to most recent or create new\r\n            const remaining = Object.values(sessions).sort((a, b) => b.lastModified - a.lastModified);\r\n            if (remaining.length > 0) {\r\n                currentSessionId = remaining[0].id;\r\n            } else {\r\n                createNewSession();\r\n                return; // createNewSession handles render\r\n            }\r\n        }\r\n        saveSessions();\r\n        renderCurrentSession();\r\n        renderChatList();\r\n    }\r\n}\r\n\r\nfunction switchSession(id: string) {\r\n    if (sessions[id]) {\r\n        currentSessionId = id;\r\n        saveSessions();\r\n        renderCurrentSession();\r\n        renderChatList();\r\n    }\r\n}\r\n\r\nfunction renderCurrentSession() {\r\n    const container = document.getElementById(\"chat-history\");\r\n    if (!container || !currentSessionId || !sessions[currentSessionId]) return;\r\n\r\n    container.innerHTML = \"\"; // Clear current view\r\n    \r\n    const messages = sessions[currentSessionId].messages;\r\n    messages.forEach(msg => {\r\n        appendMessage(msg.content, msg.role as any);\r\n    });\r\n}\r\n\r\n// Global state for deletion\r\nlet sessionToDelete: string | null = null;\r\n\r\nfunction renderChatList() {\r\n    const listEl = document.getElementById(\"chat-list\");\r\n    if (!listEl) return;\r\n    \r\n    listEl.innerHTML = \"\";\r\n    \r\n    const sortedSessions = Object.values(sessions).sort((a, b) => b.lastModified - a.lastModified);\r\n    \r\n    sortedSessions.forEach(session => {\r\n        const item = document.createElement(\"div\");\r\n        item.className = `chat-item ${session.id === currentSessionId ? \"active\" : \"\"}`;\r\n        item.onclick = () => switchSession(session.id);\r\n        \r\n        const title = document.createElement(\"span\");\r\n        title.className = \"chat-item-title\";\r\n        title.textContent = session.title;\r\n        \r\n        // Menu button (3 dots)\r\n        const menuBtn = document.createElement(\"button\");\r\n        menuBtn.type = \"button\"; // Explicit type\r\n        menuBtn.className = \"chat-item-menu-btn\";\r\n        menuBtn.innerHTML = \"‚ãÆ\";\r\n        \r\n        menuBtn.addEventListener(\"click\", (e) => {\r\n            e.stopPropagation();\r\n            console.log(\"Delete menu clicked for session:\", session.id);\r\n            \r\n            // Show custom modal\r\n            sessionToDelete = session.id;\r\n            const deleteModal = document.getElementById(\"delete-modal\");\r\n            if (deleteModal) {\r\n                deleteModal.classList.remove(\"hidden\");\r\n                // Force display flex just in case\r\n                deleteModal.style.display = \"flex\";\r\n            } else {\r\n                console.error(\"Delete modal not found in DOM\");\r\n            }\r\n        });\r\n\r\n        item.appendChild(title);\r\n        item.appendChild(menuBtn);\r\n        listEl.appendChild(item);\r\n    });\r\n}\r\n\r\nfunction setupUI() {\r\n    const input = document.getElementById(\"user-input\") as HTMLTextAreaElement;\r\n    const sendBtn = document.getElementById(\"send-btn\");\r\n    \r\n    // Delete Modal Logic\r\n    const deleteModal = document.getElementById(\"delete-modal\");\r\n    const confirmDeleteBtn = document.getElementById(\"confirm-delete-btn\");\r\n    const cancelDeleteBtn = document.getElementById(\"cancel-delete-btn\");\r\n\r\n    confirmDeleteBtn?.addEventListener(\"click\", () => {\r\n        if (sessionToDelete) {\r\n            deleteSession(sessionToDelete);\r\n            sessionToDelete = null;\r\n        }\r\n        deleteModal?.classList.add(\"hidden\");\r\n    });\r\n\r\n    cancelDeleteBtn?.addEventListener(\"click\", () => {\r\n        sessionToDelete = null;\r\n        deleteModal?.classList.add(\"hidden\");\r\n    });\r\n    \r\n    // Sidebar Logic\r\n    const sidebar = document.getElementById(\"sidebar\");\r\n    const closeSidebarBtn = document.getElementById(\"sidebar-toggle-close\");\r\n    const openSidebarBtn = document.getElementById(\"sidebar-toggle-open\");\r\n\r\n    function updateSidebarState(collapsed: boolean) {\r\n        if (collapsed) {\r\n            sidebar?.classList.add(\"collapsed\");\r\n            openSidebarBtn?.classList.remove(\"hidden\");\r\n        } else {\r\n            sidebar?.classList.remove(\"collapsed\");\r\n            openSidebarBtn?.classList.add(\"hidden\");\r\n        }\r\n    }\r\n\r\n    closeSidebarBtn?.addEventListener(\"click\", () => updateSidebarState(true));\r\n    openSidebarBtn?.addEventListener(\"click\", () => updateSidebarState(false));\r\n\r\n    const newChatBtn = document.getElementById(\"new-chat-btn\");\r\n    newChatBtn?.addEventListener(\"click\", () => {\r\n        createNewSession();\r\n        // Auto-open sidebar on mobile? Optional.\r\n        if (window.innerWidth < 600) updateSidebarState(true); \r\n    });\r\n\r\n    // Textarea Auto-resize\r\n    input.addEventListener(\"input\", () => {\r\n        input.style.height = \"auto\";\r\n        input.style.height = Math.min(input.scrollHeight, 150) + \"px\"; // Cap at ~6-7 lines\r\n    });\r\n\r\n    // Settings Button (moved to footer)\r\n    const settingsBtn = document.getElementById(\"settings-btn\");\r\n    const modal = document.getElementById(\"settings-modal\");\r\n    const saveSettings = document.getElementById(\"save-settings-btn\");\r\n    const modelSelect = document.getElementById(\"model-select\") as HTMLSelectElement;\r\n    const modelListContainer = document.getElementById(\"model-list\");\r\n    const addModelBtn = document.getElementById(\"add-model-btn\");\r\n\r\n    interface Model {\r\n        id: string;\r\n        name: string;\r\n    }\r\n\r\n    const defaultModels: Model[] = [\r\n        { id: \"stepfun/step-3.5-flash:free\", name: \"StepFun 3.5 Flash (Free)\" },\r\n        { id: \"google/gemini-2.0-flash-thinking-exp:free\", name: \"Gemini 2.0 Flash Thinking (Free)\" },\r\n        { id: \"google/gemini-2.0-flash-exp:free\", name: \"Gemini 2.0 Flash Exp (Free)\" },\r\n        { id: \"google/gemini-2.0-pro-exp-02-05:free\", name: \"Gemini 2.0 Pro Exp (Free)\" },\r\n        { id: \"deepseek/deepseek-r1:free\", name: \"DeepSeek R1 (Free)\" },\r\n        { id: \"meta-llama/llama-3.3-70b-instruct:free\", name: \"Llama 3.3 70B (Free)\" }\r\n    ];\r\n\r\n    let models: Model[] = [];\r\n\r\n    // --- Model Management Logic ---\r\n\r\n    function loadModels() {\r\n        const stored = localStorage.getItem(\"openrouter_models\");\r\n        if (stored) {\r\n            try {\r\n                models = JSON.parse(stored);\r\n            } catch (e) {\r\n                console.error(\"Failed to parse models\", e);\r\n                models = [...defaultModels];\r\n            }\r\n        } else {\r\n            models = [...defaultModels];\r\n        }\r\n        renderModelSelect();\r\n        renderModelList();\r\n    }\r\n\r\n    function saveModels() {\r\n        localStorage.setItem(\"openrouter_models\", JSON.stringify(models));\r\n        renderModelSelect();\r\n        renderModelList();\r\n    }\r\n\r\n    function renderModelSelect() {\r\n        const currentVal = modelSelect.value;\r\n        modelSelect.innerHTML = \"\";\r\n        models.forEach(m => {\r\n            const opt = document.createElement(\"option\");\r\n            opt.value = m.id;\r\n            opt.textContent = m.name;\r\n            modelSelect.appendChild(opt);\r\n        });\r\n        if (currentVal && models.some(m => m.id === currentVal)) {\r\n            modelSelect.value = currentVal;\r\n        } else if (models.length > 0) {\r\n            modelSelect.value = models[0].id; // Default to first\r\n        }\r\n    }\r\n\r\n    function renderModelList() {\r\n        if (!modelListContainer) return;\r\n        modelListContainer.innerHTML = \"\";\r\n        \r\n        models.forEach((m, index) => {\r\n            const item = document.createElement(\"div\");\r\n            item.className = \"model-item\";\r\n            item.innerHTML = `\r\n                <div class=\"model-info\">\r\n                    <span class=\"model-name\">${m.name}</span>\r\n                    <span class=\"model-id\">${m.id}</span>\r\n                </div>\r\n                <button class=\"delete-model-btn\" data-index=\"${index}\" title=\"Delete\">üóëÔ∏è</button>\r\n            `;\r\n            modelListContainer.appendChild(item);\r\n        });\r\n    }\r\n\r\n    // Event Delegation for Delete\r\n    modelListContainer?.addEventListener(\"click\", (e) => {\r\n        const target = e.target as HTMLElement;\r\n        const btn = target.closest(\".delete-model-btn\");\r\n        if (btn) {\r\n            const idx = parseInt(btn.getAttribute(\"data-index\") || \"-1\");\r\n            if (idx > -1) {\r\n                // Use a custom confirm or just proceed? Standard confirm OK.\r\n                // Wrap in try-catch just in case of environment issues\r\n                try {\r\n                    models.splice(idx, 1);\r\n                    saveModels();\r\n                } catch (err) {\r\n                    console.error(\"Delete failed\", err);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    // Initialize Models\r\n    loadModels();\r\n\r\n    // Add Model Listener\r\n    addModelBtn?.addEventListener(\"click\", () => {\r\n        const idInput = document.getElementById(\"new-model-id\") as HTMLInputElement;\r\n        const nameInput = document.getElementById(\"new-model-name\") as HTMLInputElement;\r\n        \r\n        const id = idInput.value.trim();\r\n        const name = nameInput.value.trim();\r\n\r\n        if (!id || !name) {\r\n            alert(\"Please enter both Model ID and Display Name\");\r\n            return;\r\n        }\r\n\r\n        models.push({ id, name });\r\n        saveModels();\r\n        \r\n        idInput.value = \"\";\r\n        nameInput.value = \"\";\r\n    });\r\n\r\n    // Load saved key if available\r\n    const savedKey = localStorage.getItem(\"openrouter_key\");\r\n    if (savedKey) {\r\n        (document.getElementById(\"api-key-input\") as HTMLInputElement).value = savedKey;\r\n    }\r\n\r\n    // Settings Modal\r\n    settingsBtn?.addEventListener(\"click\", () => {\r\n        modal?.classList.remove(\"hidden\");\r\n        // Re-render list to ensure freshness\r\n        renderModelList(); \r\n    });\r\n    \r\n    document.getElementById(\"close-settings-btn\")?.addEventListener(\"click\", () => modal?.classList.add(\"hidden\"));\r\n    \r\n    saveSettings?.addEventListener(\"click\", () => {\r\n        const key = (document.getElementById(\"api-key-input\") as HTMLInputElement).value.trim();\r\n        if (key) {\r\n            localStorage.setItem(\"openrouter_key\", key);\r\n            appendMessage(\"API Key saved!\", \"ai\");\r\n            // Don't auto-close, let user manage models too\r\n        } \r\n        \r\n        // Also save models just in case (though they save on add/delete)\r\n        saveModels();\r\n        modal?.classList.add(\"hidden\");\r\n    });\r\n\r\n    // --- Context & Command Bridge ---\r\n    let pendingContextResolve: ((value: any) => void) | null = null;\r\n    let pendingExecResolve: ((value: any) => void) | null = null;\r\n\r\n    Office.context.ui.addHandlerAsync(Office.EventType.DialogParentMessageReceived, (arg: any) => {\r\n        console.log(\"Message from parent:\", arg.message);\r\n        try {\r\n            const msg = JSON.parse(arg.message);\r\n            if (msg.type === \"CONTEXT\" && pendingContextResolve) {\r\n                pendingContextResolve(msg.data);\r\n                pendingContextResolve = null;\r\n            } else if (msg.type === \"EXECUTION_RESULT\" && pendingExecResolve) {\r\n                pendingExecResolve(msg.data);\r\n                pendingExecResolve = null;\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Failed to parse parent message\", e);\r\n        }\r\n    });\r\n\r\n    function getContextFromParent(): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            pendingContextResolve = resolve;\r\n            Office.context.ui.messageParent(\"GET_CONTEXT\");\r\n            // Timeout fallback?\r\n            setTimeout(() => {\r\n                if (pendingContextResolve) {\r\n                    console.warn(\"Context request timed out\");\r\n                    pendingContextResolve({}); // Resolve empty to avoid hanging\r\n                    pendingContextResolve = null;\r\n                }\r\n            }, 3000);\r\n        });\r\n    }\r\n\r\n    function executeCommandsInParent(commands: any[]): Promise<any> {\r\n        return new Promise((resolve) => {\r\n            pendingExecResolve = resolve;\r\n            const payload = JSON.stringify({ type: \"EXECUTE\", commands: commands });\r\n            Office.context.ui.messageParent(payload);\r\n            \r\n            // Timeout?\r\n             setTimeout(() => {\r\n                if (pendingExecResolve) {\r\n                    pendingExecResolve({ success: false, errors: [\"Timeout\"] });\r\n                    pendingExecResolve = null;\r\n                }\r\n            }, 60000); // 60s timeout for Excel ops\r\n        });\r\n    }\r\n\r\n\r\n\r\n    function validateCommands(commands: any[]): { valid: boolean; errors: string[] } {\r\n        const errors: string[] = [];\r\n        \r\n        commands.forEach((cmd, idx) => {\r\n            // Check parser errors\r\n            if (cmd.type === \"ERROR\") {\r\n                errors.push(`Command ${idx + 1}: ${cmd.args[0] || 'Parser error'} ‚Äî ${cmd.original}`);\r\n                return;\r\n            }\r\n\r\n            // Check args existence\r\n            if (cmd.type === \"DELETE_ROWS\" || cmd.type === \"INSERT_ROWS\") {\r\n                if (!cmd.args[0] || !/^\\d+:\\d+$/.test(cmd.args[0])) {\r\n                    errors.push(`Command ${idx + 1} (${cmd.type}): Expected format N:N, got: ${cmd.args[0] || 'empty'}`);\r\n                }\r\n            }\r\n            \r\n            // Validate COPY\r\n            if (cmd.type === \"COPY\" && cmd.args.length < 2) {\r\n                errors.push(`Command ${idx + 1} (COPY): Requires source and target ranges`);\r\n            }\r\n            \r\n            // Validate SET_VALUE/SET_FORMULA\r\n            if ((cmd.type === \"SET_VALUE\" || cmd.type === \"SET_FORMULA\") && cmd.args.length < 2) {\r\n                errors.push(`Command ${idx + 1} (${cmd.type}): Requires address and value`);\r\n            }\r\n            \r\n            // Validate FORMAT commands\r\n            if (cmd.type.startsWith(\"FORMAT_\") && cmd.args.length < 2) {\r\n                errors.push(`Command ${idx + 1} (${cmd.type}): Requires address and value`);\r\n            }\r\n            \r\n            // Validate SORT\r\n            if (cmd.type === \"SORT\" && cmd.args.length < 3) {\r\n                errors.push(`Command ${idx + 1} (SORT): Requires range, column index, and order`);\r\n            }\r\n        });\r\n        \r\n        return { valid: errors.length === 0, errors };\r\n    }\r\n\r\n    // Send Message Logic\r\n    async function sendMessage() {\r\n        if (!currentSessionId || !sessions[currentSessionId]) {\r\n            createNewSession();\r\n        }\r\n        \r\n        const text = input.value.trim();\r\n        if (!text) return;\r\n        \r\n        const apiKey = localStorage.getItem(\"openrouter_key\");\r\n        if (!apiKey) {\r\n            modal?.classList.remove(\"hidden\");\r\n            appendMessage(\"Please set your OpenRouter API Key in settings first.\", \"ai\");\r\n            return;\r\n        }\r\n\r\n        const includeData = (document.getElementById(\"include-data\") as HTMLInputElement).checked;\r\n\r\n        appendMessage(text, \"user\");\r\n        input.value = \"\";\r\n        // Reset height\r\n        input.style.height = \"auto\";\r\n        \r\n        // Show thinking state\r\n        const thinkingId = appendMessage(\"Thinking...\", \"ai\", true);\r\n\r\n        // 1. Get Context\r\n        let contextData = null;\r\n        if (includeData) {\r\n            try {\r\n                contextData = await getContextFromParent();\r\n            } catch (e) {\r\n                console.error(\"Error fetching context\", e);\r\n            }\r\n        }\r\n\r\n        // 2. Prepare System Prompt with DSL Instructions\r\n        const systemPrompt = `You are an Excel automation assistant. You translate user requests into executable commands.\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nEXAMPLES (Follow this reasoning pattern)\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nüìù Example 1: \"–ü–µ—Ä–µ–Ω–µ—Å–∏ —Å—Ç—Ä–æ–∫—É 5 –ø–æ–¥ —Å—Ç—Ä–æ–∫—É 10\"\r\nThinking: Move row 5 to AFTER row 10. Source=5, Target=10, Position=after\r\nMOVE_ROW|5|10|after\r\n\r\nüìù Example 2: \"–£–¥–∞–ª–∏ —Å—Ç—Ä–æ–∫—É —Å –ò–≤–∞–Ω–æ–≤—ã–º\"\r\nContext shows: Row 4 = [\"–ò–≤–∞–Ω–æ–≤\", \"–ú–µ–Ω–µ–¥–∂–µ—Ä\", 50000]\r\nDELETE_ROWS|4:4\r\n\r\nüìù Example 3: \"–°–¥–µ–ª–∞–π —è—á–µ–π–∫—É B2 –∫—Ä–∞—Å–Ω–æ–π –∏ –∂–∏—Ä–Ω–æ–π\"\r\nFORMAT_COLOR|B2|red\r\nFORMAT_BOLD|B2|true\r\n\r\nüìù Example 4: \"–ü–æ–º–µ–Ω—è–π –º–µ—Å—Ç–∞–º–∏ —Å—Ç—Ä–æ–∫–∏ 3 –∏ 7\"\r\nSWAP_ROWS|3|7\r\n\r\nüìù Example 5: \"–°–∫–æ–ø–∏—Ä—É–π —Ç–∞–±–ª–∏—Ü—É A1:D10 –Ω–∞ –Ω–æ–≤—ã–π –ª–∏—Å—Ç\"\r\nCREATE_SHEET|–ö–æ–ø–∏—è\r\nCOPY|Sheet1!A1:D10|–ö–æ–ø–∏—è!A1\r\n\r\nüìù Example 6: User asks \"–ß—Ç–æ –∑–¥–µ—Å—å –Ω–∞–ø–∏—Å–∞–Ω–æ?\"\r\n(This is a QUESTION, not an action request)\r\n‚Üí Reply with text, NO commands\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nINTENT CLASSIFICATION (Check FIRST before generating commands)\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nüîç QUESTION INTENTS (Reply with text, NO commands):\r\n- \"–ß—Ç–æ —ç—Ç–æ?\", \"–°–∫–æ–ª—å–∫–æ?\", \"–ö–∞–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞?\", \"–û–±—ä—è—Å–Ω–∏\"\r\n- \"–ü–æ–º–æ–≥–∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è\", \"–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç\"\r\n\r\nüîß ACTION INTENTS (Output commands ONLY):\r\n- \"–°–¥–µ–ª–∞–π\", \"–£–¥–∞–ª–∏\", \"–ü–µ—Ä–µ–Ω–µ—Å–∏\", \"–°–∫–æ–ø–∏—Ä—É–π\", \"–°–æ–∑–¥–∞–π\"\r\n- \"–ü–æ–∫—Ä–∞—Å—å\", \"–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π\", \"–°–æ—Ä—Ç–∏—Ä—É–π\"\r\n\r\n‚ùì CLARIFICATION NEEDED:\r\n- Ambiguous references: \"—ç—Ç—É —Å—Ç—Ä–æ–∫—É\" (which one?)\r\n- Multiple matches: \"–ò–≤–∞–Ω–æ–≤\" appears in rows 4 and 12\r\n- Missing target: \"–°–∫–æ–ø–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ\" (–∫—É–¥–∞?)\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nCOMMAND REFERENCE\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\n‚ñ∏ CELL OPERATIONS\r\n  SET_VALUE|Address|Value\r\n  SET_FORMULA|Address|Formula  \r\n  FORMAT_BOLD|Address|true/false\r\n  FORMAT_COLOR|Address|ColorCode\r\n  FORMAT_FILL|Address|ColorCode\r\n  CLEAR|Address\r\n  SELECT|Address\r\n\r\n‚ñ∏ ROW OPERATIONS (use row notation like 5:5, NOT A5)\r\n  DELETE_ROWS|RowRange        ‚Üí DELETE_ROWS|5:5 or DELETE_ROWS|2:10\r\n  INSERT_ROWS|RowRange        ‚Üí INSERT_ROWS|5:5 (inserts BEFORE row 5)\r\n  COPY_ROW|SourceRow|TargetRow ‚Üí COPY_ROW|5|10 (copies row 5 to row 10)\r\n  MOVE_ROW|SourceRowIndex|TargetRowIndex|Position ‚Üí Position: before|after\r\n  SWAP_ROWS|Row1|Row2   ‚Üí Swaps row 1 and row 2\r\n\r\n‚ñ∏ COLUMN OPERATIONS  \r\n  DELETE_COLUMNS|ColRange     ‚Üí DELETE_COLUMNS|B:B or DELETE_COLUMNS|A:C\r\n  INSERT_COLUMNS|ColRange     ‚Üí INSERT_COLUMNS|B:B\r\n\r\n‚ñ∏ DATA OPERATIONS\r\n  COPY|SourceRange|TargetRange\r\n  SORT|Range|ColumnIndex(0-based)|Ascending(true/false)\r\n\r\n‚ñ∏ SHEET OPERATIONS\r\n  CREATE_SHEET|Name\r\n  DELETE_SHEET|Name\r\n  RENAME_SHEET|NewName                    (active sheet)\r\n  RENAME_SHEET|OldName|NewName            (specific sheet)\r\n  ACTIVATE_SHEET|Name\r\n\r\n‚ñ∏ CHARTS\r\n  CREATE_CHART|Type|DataRange|Title       (Types: ColumnClustered/Line/Pie/Bar)\r\n  DELETE_CHART|Title\r\n  DELETE_ALL_CHARTS\r\n\r\n‚ñ∏ SPECIAL\r\n  UNDO    (ONLY for explicit: \"–æ—Ç–º–µ–Ω–∏\", \"–Ω–∞–∑–∞–¥\", \"undo\", \"–≤–µ—Ä–Ω–∏\")\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nCRITICAL RULES FOR ROW MOVEMENT\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\n‚ö†Ô∏è RULE 1: INDEX SHIFT AWARENESS\r\nWhen you INSERT a row, all rows BELOW shift down by 1.\r\nWhen you DELETE a row, all rows BELOW shift up by 1.\r\nYou MUST account for this in multi-step operations.\r\n*NOTE: MOVE_ROW command handles this automatically. Prefer using it if possible.*\r\n\r\n‚ö†Ô∏è RULE 2: MOVE ROW ALGORITHM (Manual Steps if not using MOVE_ROW)\r\n- MOVING ROW DOWN (source < target): INSERT at Target+1, COPY, DELETE Source.\r\n- MOVING ROW UP (source > target): INSERT at Target, COPY Source+1, DELETE Source+1.\r\n\r\n‚ö†Ô∏è RULE 3: LANGUAGE INTERPRETATION (Russian)\r\n- \"–ø–æ–¥ —Å—Ç—Ä–æ–∫–æ–π X\" / \"–ø–æ—Å–ª–µ X\" ‚Üí AFTER row X (insert at X+1)\r\n- \"–Ω–∞–¥ —Å—Ç—Ä–æ–∫–æ–π X\" / \"–ø–µ—Ä–µ–¥ X\" / \"–≤—ã—à–µ X\" ‚Üí BEFORE row X (insert at X)\r\n- \"–Ω–∞ –º–µ—Å—Ç–æ X\" ‚Üí REPLACE position X\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nAMBIGUITY HANDLING\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\nIf a value appears in MULTIPLE rows:\r\n‚ùå DO NOT execute\r\n‚úÖ ASK: \"–ù–∞—à—ë–ª '–ò–≤–∞–Ω–æ–≤' –≤ —Å—Ç—Ä–æ–∫–∞—Ö 4 –∏ 12. –ö–∞–∫—É—é —Å—Ç—Ä–æ–∫—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å?\"\r\n\r\nIf command is unclear:\r\n‚ùå DO NOT guess\r\n‚úÖ ASK for clarification\r\n\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\nOUTPUT FORMAT\r\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n\r\n‚úÖ Commands ONLY (one per line, no extra text)\r\n‚úÖ OR clarifying question ONLY (no commands mixed in)\r\n‚ùå NEVER mix commands with explanatory text`;\r\n\r\n        let fullPrompt = systemPrompt;\r\n\r\n        if (contextData && contextData.sheetName) {\r\n            fullPrompt += `\\n\\nCURRENT EXCEL CONTEXT:\\nSheet: ${contextData.sheetName}\\nSelection: ${contextData.address}\\nValues (Selection):\\n${JSON.stringify(contextData.values)}`;\r\n            if (contextData.usedRange) {\r\n                // Parse start row from address like \"Sheet1!A2:D10\" or \"A2:D10\"\r\n                const rangeAddress = contextData.usedRange.address;\r\n                const addressWithoutSheet = rangeAddress.includes('!') \r\n                    ? rangeAddress.split('!')[1] \r\n                    : rangeAddress;\r\n                \r\n                // Match \"2\" from \"A2\"\r\n                const startRowMatch = addressWithoutSheet.match(/[A-Z]+(\\d+)/i);\r\n                const startRow = startRowMatch ? parseInt(startRowMatch[1]) : 1;\r\n\r\n                const rowsWithNumbers = (contextData.usedRange.values as any[][]).map((row, idx) => \r\n                    `Row ${startRow + idx}: ${JSON.stringify(row)}` \r\n                ).join('\\n');\r\n                \r\n                fullPrompt += `\\n\\nSheet Overview (Used Range: ${contextData.usedRange.address}):\\n${rowsWithNumbers}`;\r\n            }\r\n        }\r\n\r\n        // Construct Message Chain\r\n        // Always start with System Prompt\r\n        const messages: LLMMessage[] = [{ role: \"system\", content: fullPrompt }];\r\n        \r\n        // Append History from current session\r\n        const sessionHistory = sessions[currentSessionId!].messages;\r\n        \r\n        // Limit context window if needed (last 20)\r\n        let contextMessages = sessionHistory;\r\n        if (sessionHistory.length > 20) {\r\n            contextMessages = sessionHistory.slice(sessionHistory.length - 20);\r\n        }\r\n        messages.push(...contextMessages);\r\n        \r\n        // Append Current User Message\r\n        const currentUserMsg: LLMMessage = { role: \"user\", content: text };\r\n        messages.push(currentUserMsg);\r\n\r\n        const model = modelSelect.value;\r\n        const currentId = currentSessionId!; // Capture for async closure\r\n\r\n        try {\r\n            // 3. Call LLM\r\n            const response = await OpenRouterService.complete(messages, model, apiKey);\r\n            removeMessage(thinkingId);\r\n\r\n            if (response.error) {\r\n                appendMessage(`Error: ${response.error}`, \"ai\");\r\n                return;\r\n            }\r\n            \r\n            // Add user message to session history (only on success)\r\n            sessions[currentId].messages.push(currentUserMsg);\r\n            \r\n            // Update Title if it's the first user message (and title is default)\r\n            if (sessions[currentId].messages.length <= 2 && sessions[currentId].title === \"New Chat\") {\r\n                 sessions[currentId].title = text.substring(0, 30) + (text.length > 30 ? \"...\" : \"\");\r\n            }\r\n            sessions[currentId].lastModified = Date.now();\r\n            renderChatList(); // Update sidebar order\r\n\r\n            // 4. Parse Commands\r\n            const rawContent = response.content || \"\";\r\n            \r\n            // Add AI response to history\r\n            const aiMsg: LLMMessage = { role: \"assistant\", content: rawContent };\r\n            sessions[currentId].messages.push(aiMsg);\r\n            saveSessions(); // Save state\r\n\r\n            const parsed = CommandParser.parse(rawContent);\r\n\r\n            // Display \"Clean\" text (chat response)\r\n            if (parsed.text) {\r\n                appendMessage(parsed.text, \"ai\");\r\n            } \r\n            \r\n            // Fallback if empty\r\n            if (!parsed.text && parsed.commands.length === 0) {\r\n                 appendMessage(rawContent || \"(Empty response)\", \"ai\");\r\n            }\r\n\r\n            // 5. Execute Commands\r\n            if (parsed.commands.length > 0) {\r\n                const validation = validateCommands(parsed.commands);\r\n                if (!validation.valid) {\r\n                    appendMessage(`‚ö†Ô∏è Validation Errors:\\n${validation.errors.join(\"\\n\")}`, \"ai\");\r\n                    return;\r\n                }\r\n\r\n                const execMsgId = appendMessage(`Executing ${parsed.commands.length} actions...`, \"ai\", true);\r\n                \r\n                const result = await executeCommandsInParent(parsed.commands);\r\n                \r\n                removeMessage(execMsgId);\r\n                \r\n                if (result.success) {\r\n                    const cmdDisplay = parsed.commands.map(c => c.original).join(\"\\n\");\r\n                    appendMessage(`‚úÖ Executed:\\n${cmdDisplay}`, \"ai\");\r\n                } else {\r\n                    appendMessage(`‚ö†Ô∏è Errors: ${result.errors.join(\", \")}`, \"ai\");\r\n                }\r\n            }\r\n\r\n        } catch (err) {\r\n            removeMessage(thinkingId);\r\n            appendMessage(`System Error: ${err}`, \"ai\");\r\n        }\r\n    }\r\n\r\n    sendBtn?.addEventListener(\"click\", sendMessage);\r\n    \r\n    input.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Enter\" && !e.shiftKey) {\r\n            e.preventDefault();\r\n            sendMessage();\r\n        }\r\n        // Shift+Enter is handled natively by textarea (new line)\r\n    });\r\n}\r\n\r\nfunction appendMessage(text: string, sender: \"user\" | \"ai\", isTemporary: boolean = false): string {\r\n    const container = document.getElementById(\"chat-history\");\r\n    const msgDiv = document.createElement(\"div\");\r\n    const id = `msg-${Date.now()}-${Math.random()}`;\r\n    msgDiv.id = id;\r\n    msgDiv.className = `message message-${sender}${isTemporary ? ' temporary' : ''}`;\r\n    \r\n    const avatar = document.createElement(\"div\");\r\n    avatar.className = \"avatar\";\r\n    avatar.textContent = sender === \"ai\" ? \"ü§ñ\" : \"üë§\";\r\n    \r\n    const content = document.createElement(\"div\");\r\n    content.className = \"message-content\";\r\n    \r\n    if (sender === \"ai\") {\r\n        // Safer marked usage (no raw HTML)\r\n        // @ts-ignore\r\n        const renderer = new marked.Renderer();\r\n        renderer.html = () => ''; \r\n        // @ts-ignore\r\n        content.innerHTML = marked.parse(text, { renderer });\r\n    } else {\r\n        content.innerText = text;\r\n    }\r\n    \r\n    msgDiv.appendChild(avatar);\r\n    msgDiv.appendChild(content);\r\n    \r\n    if (container) {\r\n        container.appendChild(msgDiv);\r\n        container.scrollTop = container.scrollHeight;\r\n    }\r\n\r\n    return id;\r\n}\r\n\r\nfunction removeMessage(id: string) {\r\n    const el = document.getElementById(id);\r\n    if (el) el.remove();\r\n}\r\n","// Imports\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./dialog.css\", import.meta.url);\n// Module\nvar code = \"<!doctype html> <html lang=\\\"ru\\\"> <head> <meta charset=\\\"UTF-8\\\"/> <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=Edge\\\"/> <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1\\\"/> <title>AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</title> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1/hosted/office.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\\\"><\" + \"/script> <link href=\\\"\" + ___HTML_LOADER_IMPORT_0___ + \"\\\" rel=\\\"stylesheet\\\"/> <link rel=\\\"preconnect\\\" href=\\\"https://fonts.googleapis.com\\\"/> <link rel=\\\"preconnect\\\" href=\\\"https://fonts.gstatic.com\\\" crossorigin/> <link href=\\\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap\\\" rel=\\\"stylesheet\\\"/> </head> <body> <div class=\\\"app-layout\\\"> <aside class=\\\"sidebar\\\" id=\\\"sidebar\\\"> <div class=\\\"sidebar-header\\\"> <button id=\\\"new-chat-btn\\\" class=\\\"new-chat-btn\\\"> <span>+</span> –ù–æ–≤—ã–π —á–∞—Ç </button> <button id=\\\"sidebar-toggle-close\\\" class=\\\"icon-btn\\\" title=\\\"–°–≤–µ—Ä–Ω—É—Ç—å\\\"> ‚óÄ </button> </div> <div class=\\\"chat-list\\\" id=\\\"chat-list\\\"> </div> <div class=\\\"sidebar-footer\\\"> <button id=\\\"settings-btn\\\" class=\\\"settings-btn-sidebar\\\"> ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ </button> </div> </aside> <main class=\\\"main-content\\\" id=\\\"main-content\\\"> <header class=\\\"app-header\\\"> <div class=\\\"header-left\\\"> <button id=\\\"sidebar-toggle-open\\\" class=\\\"icon-btn hidden\\\" title=\\\"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å\\\"> ‚ñ∂ </button> <div class=\\\"header-title\\\">AI Excel Assistant</div> </div> <div class=\\\"header-actions\\\"> </div> </header> <div class=\\\"chat-history\\\" id=\\\"chat-history\\\"> <div class=\\\"message message-ai\\\"> <div class=\\\"avatar\\\">ü§ñ</div> <div class=\\\"message-content\\\"> –ü—Ä–∏–≤–µ—Ç! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å Excel. </div> </div> </div> <div class=\\\"input-area\\\"> <div class=\\\"toolbar\\\"> <div class=\\\"model-selector-wrapper\\\"> <select id=\\\"model-select\\\" class=\\\"model-select\\\"></select> </div> <div class=\\\"context-toggles\\\"> <label class=\\\"toggle-label\\\" title=\\\"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ AI\\\"> <input type=\\\"checkbox\\\" id=\\\"include-data\\\" checked=\\\"checked\\\"/> <span>üìù –î–∞–Ω–Ω—ã–µ</span> </label> </div> </div> <div class=\\\"input-wrapper\\\"> <textarea id=\\\"user-input\\\" placeholder=\\\"–°–æ–æ–±—â–µ–Ω–∏–µ... (Shift+Enter –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞)\\\" rows=\\\"1\\\"></textarea> <button id=\\\"send-btn\\\" class=\\\"send-btn\\\"> <svg width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\"> <line x1=\\\"22\\\" y1=\\\"2\\\" x2=\\\"11\\\" y2=\\\"13\\\"></line> <polygon points=\\\"22 2 15 22 11 13 2 9 22 2\\\"></polygon> </svg> </button> </div> </div> </main> </div> <div id=\\\"settings-modal\\\" class=\\\"modal hidden\\\"> <div class=\\\"modal-content\\\"> <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3> <div class=\\\"form-group\\\"> <label>OpenRouter API Key</label> <input type=\\\"password\\\" id=\\\"api-key-input\\\" placeholder=\\\"sk-or-...\\\"/> </div> <div class=\\\"modal-actions\\\"> <button id=\\\"save-settings-btn\\\" class=\\\"primary-btn\\\">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å API Key</button> <button id=\\\"close-settings-btn\\\" class=\\\"secondary-btn\\\">–ó–∞–∫—Ä—ã—Ç—å</button> </div> <hr class=\\\"settings-divider\\\"/> <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏</h3> <div class=\\\"model-management\\\"> <div id=\\\"model-list\\\" class=\\\"model-list\\\"> </div> <div class=\\\"add-model-form\\\"> <h4>–î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å</h4> <input type=\\\"text\\\" id=\\\"new-model-id\\\" placeholder=\\\"Model ID (e.g. google/gemini-pro)\\\"/> <input type=\\\"text\\\" id=\\\"new-model-name\\\" placeholder=\\\"Display Name\\\"/> <button id=\\\"add-model-btn\\\" class=\\\"secondary-btn small-btn\\\"> ‚ûï –î–æ–±–∞–≤–∏—Ç—å </button> </div> </div> </div> </div> <div id=\\\"delete-modal\\\" class=\\\"modal hidden\\\"> <div class=\\\"modal-content\\\"> <h3>–£–¥–∞–ª–∏—Ç—å —á–∞—Ç?</h3> <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p> <div class=\\\"modal-actions\\\"> <button id=\\\"confirm-delete-btn\\\" class=\\\"primary-btn\\\" style=\\\"background-color:#ef4444\\\">–£–¥–∞–ª–∏—Ç—å</button> <button id=\\\"cancel-delete-btn\\\" class=\\\"secondary-btn\\\">–û—Ç–º–µ–Ω–∞</button> </div> </div> </div> </body> </html> \";\n// Exports\nexport default code;"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","g","globalThis","this","Function","e","window","o","obj","prop","Object","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","tagName","toUpperCase","src","scripts","getElementsByTagName","length","i","test","Error","replace","p","b","baseURI","self","href","t","r","Symbol","n","iterator","toStringTag","c","Generator","u","create","_regeneratorDefine2","f","y","G","v","a","d","bind","l","TypeError","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_defineProperties","_toPropertyKey","key","_typeof","toPrimitive","String","_toPrimitive","OpenRouterService","_classCallCheck","_callee","messages","model","apiKey","response","errorText","data","_t","_context","error","fetch","API_URL","method","headers","concat","body","JSON","stringify","ok","text","status","json","choices","content","message","_complete","arguments","apply","_next","_throw","_x","_x2","_x3","CommandParser","_createClass","input","_step","cleanInput","commands","cleanText","_iterator","_createForOfIteratorHelper","split","s","trimmed","trim","upperTrimmed","NO_ARG_COMMANDS","includes","push","type","args","original","join","match","map","expanded","expandCommand","_toConsumableArray","err","expandMoveRow","expandSwapRows","sourceRow","parseInt","targetRow","isNaN","console","insertAt","toLowerCase","shiftedSource","row1","row2","tempRow","Math","max","Array","isArray","_arrayLikeToArray","_arrayWithoutHoles","from","_iterableToArray","toString","slice","constructor","name","_unsupportedIterableToArray","_nonIterableSpread","initApp","_document$getElementB","getElementById","sendBtn","deleteModal","confirmDeleteBtn","cancelDeleteBtn","addEventListener","sessionToDelete","id","sessions","currentSessionId","remaining","values","sort","lastModified","createNewSession","saveSessions","renderCurrentSession","renderChatList","deleteSession","classList","add","sidebar","closeSidebarBtn","openSidebarBtn","updateSidebarState","collapsed","remove","newChatBtn","innerWidth","style","height","min","scrollHeight","settingsBtn","modal","saveSettings","modelSelect","modelListContainer","addModelBtn","defaultModels","models","saveModels","localStorage","setItem","renderModelSelect","renderModelList","currentVal","innerHTML","forEach","opt","createElement","textContent","appendChild","some","index","item","className","btn","target","closest","idx","getAttribute","splice","stored","getItem","parse","loadModels","idInput","nameInput","alert","savedKey","appendMessage","pendingContextResolve","pendingExecResolve","getContextFromParent","Office","context","ui","messageParent","setTimeout","warn","executeCommandsInParent","payload","success","errors","validateCommands","cmd","startsWith","valid","sendMessage","_sendMessage","includeData","thinkingId","contextData","fullPrompt","rangeAddress","addressWithoutSheet","startRowMatch","startRow","rowsWithNumbers","sessionHistory","contextMessages","currentUserMsg","currentId","rawContent","aiMsg","parsed","validation","execMsgId","result","cmdDisplay","_t2","checked","sheetName","address","usedRange","row","role","complete","removeMessage","title","substring","Date","now","addHandlerAsync","EventType","DialogParentMessageReceived","arg","log","msg","shiftKey","preventDefault","setupUI","storedSessions","storedCurrentId","loadSessions","_defineProperty","onReady","info","host","HostType","Excel","readyState","random","container","listEl","session","onclick","menuBtn","stopPropagation","display","sender","isTemporary","msgDiv","avatar","renderer","marked","Renderer","html","innerText","scrollTop","el","URL"],"ignoreList":[],"sourceRoot":""}