# Отчет о проблеме с запуском Excel Add-in

**Цель:** Запустить Excel Add-in, размещенный на GitHub Pages, в настольной версии Excel (Sideloading через общую папку).

**Текущий статус:**

- Сайт `https://dwukus.github.io/AI-assist-excel/taskpane.html` **доступен** и корректно открывается в обычном браузере (Chrome/Edge).
- Манифест подключен в Excel через "Доверенный каталог" (Network Shared Folder).
- При запуске надстройки в Excel сразу появляется ошибка: **"ОШИБКА НАДСТРОЙКИ. Не удалось запустить эту надстройку..."**
- Кнопка "Перезапустить" не помогает.

**Что было сделано (Troubleshooting Log):**

1.  **Проверка сборки:** Проект успешно собран (`npm run build`), файлы имеют корректные пути.
2.  **Проверка доступности:** Убедились, что статика (html, js, css) отдается сервером GitHub Pages (код 200 OK).
    - Исправлена ошибка 404 на корневом домене (добавлен `index.html`).
3.  **Валидация Манифеста:**
    - Выполнена проверка `npx office-addin-manifest validate` — ошибок нет.
    - В `<AppDomains>` и `<SourceLocation>` указан верный домен `https://dwukus.github.io`.
4.  **Борьба с Кэшем:**
    - Очищена папка кэша Office: `%LOCALAPPDATA%\Microsoft\Office\16.0\Wef\`.
    - Изменен `UUID` (Id) надстройки в манифесте, чтобы Excel воспринял её как новую.
5.  **Настройки Безопасности:**
    - Домен `https://dwukus.github.io` добавлен в список `<AppDomains>` в манифесте.
    - Пользователю предложено добавить домен в "Надежные узлы" (Trusted Sites) в настройках Windows.

**Возможные причины (гипотезы):**

- **WebView2 Environment:** Проблема может быть связана с тем, как конкретная версия Excel/WebView2 обрабатывает внешние HTTPS ресурсы с GitHub Pages (возможно, блокируются скрипты или Cookie).
- **Network/Proxy:** Корпоративный фаервол или антивирус может блокировать соединение именно для процесса Excel, хотя браузер работает нормально.
- **Mixed Content:** Хотя весь сайт на HTTPS, возможно, где-то проскакивает HTTP запрос или блокируются шрифты/ассеты (CDN Office.js).

**Техническая информация:**

- **URL Манифеста:** `dist/manifest.xml`
- **Хостинг:** GitHub Pages
- **Среда:** Windows, Excel Desktop

**Обновление от AI (Troubleshooting):**

1.  **Анализ кода (Code Review):**
    - Обнаружено, что файл `src/commands/commands.ts` содержал код, специфичный для **Outlook** (`Office.MailboxEnums`, `Office.context.mailbox`), который был скопирован из шаблона.
    - В среде Excel эти объекты не существуют (`undefined`), что могло приводить к ошибке инициализации надстройки, если Excel пытался загрузить `FunctionFile` при старте.
    - **Ошибка:** Использование API Outlook в Excel Add-in недопустимо и может вызывать "ADD-IN ERROR" еще до открытия панели задач.

2.  **Выполненные действия:**
    - Исправлен файл `src/commands/commands.ts`: удален код уведомлений Outlook, оставлен только вызов `event.completed()`.
    - Пересобран проект (`npm run build`). В папке `dist/` теперь обновленные файлы.
    - **Критическое обновление Манифеста:**
      - По указанию пользователя, **полностью заменен** `manifest.xml` на PROD-версию с явными путями к `https://dwukus.github.io/AI-assist-excel/`.
      - Сгенерирован новый **UUID** (`a1b2c3d4-e5f6-7890-abcd-ef1234567890`), чтобы гарантированно сбросить кэш Excel.
      - Локальный `manifest.xml` сохранен как `manifest.dev.xml`.
      - Проект еще раз пересобран (`npm run build`). Теперь `dist/manifest.xml` гарантированно корректен.

3.  **Рекомендации (Next Steps):**
    - **Шаг 1:** Закоммитить и запушить изменения в GitHub (`git commit & git push`), чтобы GitHub Pages обновился.
    - **Шаг 2:** Повторить попытку запуска в Excel.
    - **Шаг 3:** Если ошибка сохраняется, необходимо включить **Runtime Logging** для получения точной причины ошибки.
      - Создать файл реестра (или выполнить команду PowerShell) для включения логгирования.
      - Лог покажет, почему именно WebView2 или Runtime отказывается грузить надстройку.
