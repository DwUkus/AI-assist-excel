/*! For license information please see dialog.js.LICENSE.txt */
!function(){"use strict";var e={37496:function(e,n,t){e.exports=t.p+"33bd2fed192b154c8a6a.css"}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var a=n[r]={exports:{}};return e[r](a,a.exports,t),a.exports}t.m=e,t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},function(){var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var r=n.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e}(),t.b="undefined"!=typeof document&&document.baseURI||self.location.href,function(){function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function c(n,o,a,i){var c=o&&o.prototype instanceof l?o:l,u=Object.create(c.prototype);return t(u,"_invoke",function(n,t,o){var a,i,c,l=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,t){return a=n,i=0,c=e,f.n=t,s}};function m(n,t){for(i=n,c=t,r=0;!d&&l&&!o&&r<u.length;r++){var o,a=u[r],m=f.p,p=a[2];n>3?(o=p===t)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(i=0,f.v=t,f.n=a[1]):m<p&&(o=n<3||a[0]>t||t>p)&&(a[4]=n,a[5]=t,f.n=p,i=0))}if(o||n>1)return s;throw d=!0,t}return function(o,u,p){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,p),i=u,c=p;(r=i<2?e:c)||!d;){a||(i?i<3?(i>1&&(f.n=-1),m(i,c)):f.n=c:f.v=c);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(d=f.n<0)?c:n.call(t,f))!==s)break}catch(n){a=e,i=1,c=n}finally{l=1}}return{value:r,done:d}}}(n,a,i),!0),u}var s={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var f=[][a]?r(r([][a]())):(t(r={},a,function(){return this}),r),m=d.prototype=l.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,t(m,"constructor",d),t(d,"constructor",u),u.displayName="GeneratorFunction",t(d,i,"GeneratorFunction"),t(m),t(m,i,"Generator"),t(m,a,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(n=function(){return{w:c,m:p}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){function i(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(i("next",0),i("throw",1),i("return",2))},t(e,n,r,o)}function r(e,n,t,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(r,o)}function o(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(n){var t=function(n){if("object"!=e(n)||!n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==e(t)?t:t+""}var i,c,s,l=function(){return e=function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"complete",value:(a=n().m(function e(t,r,o){var a,i,c,s;return n().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o){e.n=1;break}return e.a(2,{error:"API Key is missing"});case 1:return e.p=1,e.n=2,fetch(this.API_URL,{method:"POST",headers:{Authorization:"Bearer ".concat(o),"HTTP-Referer":"https://localhost:3000","X-Title":"AI Excel Assistant","Content-Type":"application/json"},body:JSON.stringify({model:r,messages:t})});case 2:if((a=e.v).ok){e.n=4;break}return e.n=3,a.text();case 3:return i=e.v,e.a(2,{error:"API Error ".concat(a.status,": ").concat(i)});case 4:return e.n=5,a.json();case 5:if(!((c=e.v).choices&&c.choices.length>0)){e.n=6;break}return e.a(2,{content:c.choices[0].message.content});case 6:return e.a(2,{error:"No response from model"});case 7:e.n=9;break;case 8:return e.p=8,s=e.v,e.a(2,{error:"Network error: ".concat(s.message)});case 9:return e.a(2)}},e,this,[[1,8]])}),i=function(){var e=this,n=arguments;return new Promise(function(t,o){var i=a.apply(e,n);function c(e){r(i,t,o,c,s,"next",e)}function s(e){r(i,t,o,c,s,"throw",e)}c(void 0)})},function(e,n,t){return i.apply(this,arguments)})}],t&&o(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a,i}();function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,n){if(e){if("string"==typeof e)return m(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?m(e,n):void 0}}function m(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function p(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,E(r.key),r)}}function E(e){var n=function(e){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,"string");if("object"!=u(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(n)?n:n+""}i=l,s="https://openrouter.ai/api/v1/chat/completions",(c=a(c="API_URL"))in i?Object.defineProperty(i,c,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[c]=s;var g=function(){return function(e,n,t){return t&&p(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)},0,[{key:"parse",value:function(e){var n,t=e.replace(/```[\w]*\n?([\s\S]*?)```/g,"$1"),r=[],o=t,a=function(e){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=f(e))){n&&(e=n);var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(t.split("\n"));try{for(a.s();!(n=a.n()).done;){var i=n.value.trim();if(i){var c=i.toUpperCase();if(this.NO_ARG_COMMANDS.includes(c))r.push({type:c,args:[],original:i}),o=o.split(i).join("");else{var s=i.replace(/\s*\|\s*/g,"|").match(/^([A-Za-z][A-Za-z_0-9]+)\|(.*)$/);if(s){var l=s[1].toUpperCase(),u=s[2].split("|").map(function(e){return e.trim()}),m=i,p=this.expandCommand(l,u,m);r.push.apply(r,d(p)),o=o.split(m).join("")}}}}}catch(e){a.e(e)}finally{a.f()}return{text:o=o.replace(/\n\s*\n/g,"\n").trim(),commands:r}}},{key:"expandCommand",value:function(e,n,t){switch(e){case"MOVE_ROW":return n.length>=2?this.expandMoveRow(n,t):[{type:"ERROR",args:["MOVE_ROW requires source and target rows"],original:t}];case"COPY_ROW":return n.length>=2?[{type:"COPY",args:["".concat(n[0],":").concat(n[0]),"".concat(n[1],":").concat(n[1])],original:t}]:[{type:"ERROR",args:["COPY_ROW requires source and target rows"],original:t}];case"SWAP_ROWS":return n.length>=2?this.expandSwapRows(n,t):[{type:"ERROR",args:["SWAP_ROWS requires two row numbers"],original:t}]}return[{type:e,args:n,original:t}]}},{key:"expandMoveRow",value:function(e,n){var t=parseInt(e[0]),r=parseInt(e[1]);if(isNaN(t)||isNaN(r))return console.error("Invalid MOVE_ROW arguments:",e),[{type:"ERROR",args:["Invalid row numbers"],original:n}];var o="after"===(e[2]||"after").toLowerCase()?r+1:r,a=[];if(t<o)a.push({type:"INSERT_ROWS",args:["".concat(o,":").concat(o)],original:"[MOVE‚Üì] Insert at ".concat(o)}),a.push({type:"COPY",args:["".concat(t,":").concat(t),"".concat(o,":").concat(o)],original:"[MOVE‚Üì] Copy ".concat(t,"‚Üí").concat(o)}),a.push({type:"DELETE_ROWS",args:["".concat(t,":").concat(t)],original:"[MOVE‚Üì] Delete ".concat(t)});else{var i=t+1;a.push({type:"INSERT_ROWS",args:["".concat(o,":").concat(o)],original:"[MOVE‚Üë] Insert at ".concat(o)}),a.push({type:"COPY",args:["".concat(i,":").concat(i),"".concat(o,":").concat(o)],original:"[MOVE‚Üë] Copy ".concat(i,"‚Üí").concat(o)}),a.push({type:"DELETE_ROWS",args:["".concat(i,":").concat(i)],original:"[MOVE‚Üë] Delete ".concat(i)})}return a}},{key:"expandSwapRows",value:function(e,n){var t=parseInt(e[0]),r=parseInt(e[1]);if(isNaN(t)||isNaN(r))return[{type:"ERROR",args:["Invalid row numbers"],original:n}];var o=Math.max(t,r)+1;return[{type:"INSERT_ROWS",args:["".concat(o,":").concat(o)],original:"[SWAP] Create temp row"},{type:"COPY",args:["".concat(t,":").concat(t),"".concat(o,":").concat(o)],original:"[SWAP] Save row ".concat(t)},{type:"COPY",args:["".concat(r,":").concat(r),"".concat(t,":").concat(t)],original:"[SWAP] ".concat(r,"‚Üí").concat(t)},{type:"COPY",args:["".concat(o,":").concat(o),"".concat(r,":").concat(r)],original:"[SWAP] temp‚Üí".concat(r)},{type:"DELETE_ROWS",args:["".concat(o,":").concat(o)],original:"[SWAP] Delete temp"}]}}])}();function y(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,r,o,a){var s=r&&r.prototype instanceof c?r:c,l=Object.create(s.prototype);return v(l,"_invoke",function(t,r,o){var a,c,s,l=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(n,t){return a=n,c=0,s=e,f.n=t,i}};function m(t,r){for(c=t,s=r,n=0;!d&&l&&!o&&n<u.length;n++){var o,a=u[n],m=f.p,p=a[2];t>3?(o=p===r)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(c=0,f.v=r,f.n=a[1]):m<p&&(o=t<3||a[0]>r||r>p)&&(a[4]=t,a[5]=r,f.n=p,c=0))}if(o||t>1)return i;throw d=!0,r}return function(o,u,p){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,p),c=u,s=p;(n=c<2?e:s)||!d;){a||(c?c<3?(c>1&&(f.n=-1),m(c,s)):f.n=s:f.v=s);try{if(l=2,a){if(c||(o="next"),n=a[o]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,c<2&&(c=0)}else 1===c&&(n=a.return)&&n.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((n=(d=f.n<0)?s:t.call(r,f))!==i)break}catch(n){a=e,c=1,s=n}finally{l=1}}return{value:n,done:d}}}(t,o,a),!0),l}var i={};function c(){}function s(){}function l(){}n=Object.getPrototypeOf;var u=[][r]?n(n([][r]())):(v(n={},r,function(){return this}),n),d=l.prototype=c.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,v(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=l,v(d,"constructor",l),v(l,"constructor",s),s.displayName="GeneratorFunction",v(l,o,"GeneratorFunction"),v(d),v(d,o,"Generator"),v(d,r,function(){return this}),v(d,"toString",function(){return"[object Generator]"}),(y=function(){return{w:a,m:f}})()}function v(e,n,t,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}v=function(e,n,t,r){function a(n,t){v(e,n,function(e){return this._invoke(n,t,e)})}n?o?o(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},v(e,n,t,r)}function h(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return O(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?O(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function S(e,n,t,r,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(r,o)}function R(){!function(){var e,n=document.getElementById("user-input"),t=document.getElementById("send-btn"),r=document.getElementById("delete-modal"),o=document.getElementById("confirm-delete-btn"),a=document.getElementById("cancel-delete-btn");null==o||o.addEventListener("click",function(){A&&(function(e){if(T[e]){if(delete T[e],b===e){var n=Object.values(T).sort(function(e,n){return n.lastModified-e.lastModified});if(!(n.length>0))return void N();b=n[0].id}w(),I(),C()}}(A),A=null),null==r||r.classList.add("hidden")}),null==a||a.addEventListener("click",function(){A=null,null==r||r.classList.add("hidden")});var i=document.getElementById("sidebar"),c=document.getElementById("sidebar-toggle-close"),s=document.getElementById("sidebar-toggle-open");function u(e){e?(null==i||i.classList.add("collapsed"),null==s||s.classList.remove("hidden")):(null==i||i.classList.remove("collapsed"),null==s||s.classList.add("hidden"))}null==c||c.addEventListener("click",function(){return u(!0)}),null==s||s.addEventListener("click",function(){return u(!1)});var d=document.getElementById("new-chat-btn");null==d||d.addEventListener("click",function(){N(),window.innerWidth<600&&u(!0)}),n.addEventListener("input",function(){n.style.height="auto",n.style.height=Math.min(n.scrollHeight,150)+"px"});var f=document.getElementById("settings-btn"),m=document.getElementById("settings-modal"),p=document.getElementById("save-settings-btn"),E=document.getElementById("model-select"),v=document.getElementById("model-list"),O=document.getElementById("add-model-btn"),R=[{id:"stepfun/step-3.5-flash:free",name:"StepFun 3.5 Flash (Free)"},{id:"google/gemini-2.0-flash-thinking-exp:free",name:"Gemini 2.0 Flash Thinking (Free)"},{id:"google/gemini-2.0-flash-exp:free",name:"Gemini 2.0 Flash Exp (Free)"},{id:"google/gemini-2.0-pro-exp-02-05:free",name:"Gemini 2.0 Pro Exp (Free)"},{id:"deepseek/deepseek-r1:free",name:"DeepSeek R1 (Free)"},{id:"meta-llama/llama-3.3-70b-instruct:free",name:"Llama 3.3 70B (Free)"}],P=[];function M(){localStorage.setItem("openrouter_models",JSON.stringify(P)),x(),k()}function x(){var e=E.value;E.innerHTML="",P.forEach(function(e){var n=document.createElement("option");n.value=e.id,n.textContent=e.name,E.appendChild(n)}),e&&P.some(function(n){return n.id===e})?E.value=e:P.length>0&&(E.value=P[0].id)}function k(){v&&(v.innerHTML="",P.forEach(function(e,n){var t=document.createElement("div");t.className="model-item",t.innerHTML='\n                <div class="model-info">\n                    <span class="model-name">'.concat(e.name,'</span>\n                    <span class="model-id">').concat(e.id,'</span>\n                </div>\n                <button class="delete-model-btn" data-index="').concat(n,'" title="Delete">üóëÔ∏è</button>\n            '),v.appendChild(t)}))}null==v||v.addEventListener("click",function(e){var n=e.target.closest(".delete-model-btn");if(n){var t=parseInt(n.getAttribute("data-index")||"-1");if(t>-1)try{P.splice(t,1),M()}catch(e){console.error("Delete failed",e)}}}),function(){var e=localStorage.getItem("openrouter_models");if(e)try{P=JSON.parse(e)}catch(e){console.error("Failed to parse models",e),P=[].concat(R)}else P=[].concat(R);x(),k()}(),null==O||O.addEventListener("click",function(){var e=document.getElementById("new-model-id"),n=document.getElementById("new-model-name"),t=e.value.trim(),r=n.value.trim();t&&r?(P.push({id:t,name:r}),M(),e.value="",n.value=""):alert("Please enter both Model ID and Display Name")});var D=localStorage.getItem("openrouter_key");D&&(document.getElementById("api-key-input").value=D),null==f||f.addEventListener("click",function(){null==m||m.classList.remove("hidden"),k()}),null===(e=document.getElementById("close-settings-btn"))||void 0===e||e.addEventListener("click",function(){return null==m?void 0:m.classList.add("hidden")}),null==p||p.addEventListener("click",function(){var e=document.getElementById("api-key-input").value.trim();e&&(localStorage.setItem("openrouter_key",e),L("API Key saved!","ai")),M(),null==m||m.classList.add("hidden")});var W=null,j=null;function B(){return new Promise(function(e){W=e,Office.context.ui.messageParent("GET_CONTEXT"),setTimeout(function(){W&&(console.warn("Context request timed out"),W({}),W=null)},3e3)})}function F(e){return new Promise(function(n){j=n;var t=JSON.stringify({type:"EXECUTE",commands:e});Office.context.ui.messageParent(t),setTimeout(function(){j&&(j({success:!1,errors:["Timeout"]}),j=null)},6e4)})}function U(e){var n=[];return e.forEach(function(e,t){"ERROR"!==e.type?("DELETE_ROWS"!==e.type&&"INSERT_ROWS"!==e.type||e.args[0]&&/^\d+:\d+$/.test(e.args[0])||n.push("Command ".concat(t+1," (").concat(e.type,"): Expected format N:N, got: ").concat(e.args[0]||"empty")),"COPY"===e.type&&e.args.length<2&&n.push("Command ".concat(t+1," (COPY): Requires source and target ranges")),("SET_VALUE"===e.type||"SET_FORMULA"===e.type)&&e.args.length<2&&n.push("Command ".concat(t+1," (").concat(e.type,"): Requires address and value")),e.type.startsWith("FORMAT_")&&e.args.length<2&&n.push("Command ".concat(t+1," (").concat(e.type,"): Requires address and value")),"SORT"===e.type&&e.args.length<3&&n.push("Command ".concat(t+1," (SORT): Requires range, column index, and order"))):n.push("Command ".concat(t+1,": ").concat(e.args[0]||"Parser error"," ‚Äî ").concat(e.original))}),{valid:0===n.length,errors:n}}function H(){return G.apply(this,arguments)}function G(){var e;return e=y().m(function e(){var t,r,o,a,i,c,s,u,d,f,p,v,O,S,R,I,A,P,M,x,k,D,W,j,H,G,V;return y().w(function(e){for(;;)switch(e.p=e.n){case 0:if(b&&T[b]||N(),t=n.value.trim()){e.n=1;break}return e.a(2);case 1:if(r=localStorage.getItem("openrouter_key")){e.n=2;break}return null==m||m.classList.remove("hidden"),L("Please set your OpenRouter API Key in settings first.","ai"),e.a(2);case 2:if(o=document.getElementById("include-data").checked,L(t,"user"),n.value="",n.style.height="auto",a=L("Thinking...","ai",!0),i=null,!o){e.n=6;break}return e.p=3,e.n=4,B();case 4:i=e.v,e.n=6;break;case 5:e.p=5,G=e.v,console.error("Error fetching context",G);case 6:return c='You are an Excel automation assistant. You translate user requests into executable commands.\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nEXAMPLES (Follow this reasoning pattern)\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nüìù Example 1: "–ü–µ—Ä–µ–Ω–µ—Å–∏ —Å—Ç—Ä–æ–∫—É 5 –ø–æ–¥ —Å—Ç—Ä–æ–∫—É 10"\nThinking: Move row 5 to AFTER row 10. Source=5, Target=10, Position=after\nMOVE_ROW|5|10|after\n\nüìù Example 2: "–£–¥–∞–ª–∏ —Å—Ç—Ä–æ–∫—É —Å –ò–≤–∞–Ω–æ–≤—ã–º"\nContext shows: Row 4 = ["–ò–≤–∞–Ω–æ–≤", "–ú–µ–Ω–µ–¥–∂–µ—Ä", 50000]\nDELETE_ROWS|4:4\n\nüìù Example 3: "–°–¥–µ–ª–∞–π —è—á–µ–π–∫—É B2 –∫—Ä–∞—Å–Ω–æ–π –∏ –∂–∏—Ä–Ω–æ–π"\nFORMAT_COLOR|B2|red\nFORMAT_BOLD|B2|true\n\nüìù Example 4: "–ü–æ–º–µ–Ω—è–π –º–µ—Å—Ç–∞–º–∏ —Å—Ç—Ä–æ–∫–∏ 3 –∏ 7"\nSWAP_ROWS|3|7\n\nüìù Example 5: "–°–∫–æ–ø–∏—Ä—É–π —Ç–∞–±–ª–∏—Ü—É A1:D10 –Ω–∞ –Ω–æ–≤—ã–π –ª–∏—Å—Ç"\nCREATE_SHEET|–ö–æ–ø–∏—è\nCOPY|Sheet1!A1:D10|–ö–æ–ø–∏—è!A1\n\nüìù Example 6: User asks "–ß—Ç–æ –∑–¥–µ—Å—å –Ω–∞–ø–∏—Å–∞–Ω–æ?"\n(This is a QUESTION, not an action request)\n‚Üí Reply with text, NO commands\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nINTENT CLASSIFICATION (Check FIRST before generating commands)\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nüîç QUESTION INTENTS (Reply with text, NO commands):\n- "–ß—Ç–æ —ç—Ç–æ?", "–°–∫–æ–ª—å–∫–æ?", "–ö–∞–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞?", "–û–±—ä—è—Å–Ω–∏"\n- "–ü–æ–º–æ–≥–∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è", "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç"\n\nüîß ACTION INTENTS (Output commands ONLY):\n- "–°–¥–µ–ª–∞–π", "–£–¥–∞–ª–∏", "–ü–µ—Ä–µ–Ω–µ—Å–∏", "–°–∫–æ–ø–∏—Ä—É–π", "–°–æ–∑–¥–∞–π"\n- "–ü–æ–∫—Ä–∞—Å—å", "–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π", "–°–æ—Ä—Ç–∏—Ä—É–π"\n\n‚ùì CLARIFICATION NEEDED:\n- Ambiguous references: "—ç—Ç—É —Å—Ç—Ä–æ–∫—É" (which one?)\n- Multiple matches: "–ò–≤–∞–Ω–æ–≤" appears in rows 4 and 12\n- Missing target: "–°–∫–æ–ø–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ" (–∫—É–¥–∞?)\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nCOMMAND REFERENCE\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚ñ∏ CELL OPERATIONS\n  SET_VALUE|Address|Value\n  SET_FORMULA|Address|Formula  \n  FORMAT_BOLD|Address|true/false\n  FORMAT_COLOR|Address|ColorCode\n  FORMAT_FILL|Address|ColorCode\n  CLEAR|Address\n  SELECT|Address\n\n‚ñ∏ ROW OPERATIONS (use row notation like 5:5, NOT A5)\n  DELETE_ROWS|RowRange        ‚Üí DELETE_ROWS|5:5 or DELETE_ROWS|2:10\n  INSERT_ROWS|RowRange        ‚Üí INSERT_ROWS|5:5 (inserts BEFORE row 5)\n  COPY_ROW|SourceRow|TargetRow ‚Üí COPY_ROW|5|10 (copies row 5 to row 10)\n  MOVE_ROW|SourceRowIndex|TargetRowIndex|Position ‚Üí Position: before|after\n  SWAP_ROWS|Row1|Row2   ‚Üí Swaps row 1 and row 2\n\n‚ñ∏ COLUMN OPERATIONS  \n  DELETE_COLUMNS|ColRange     ‚Üí DELETE_COLUMNS|B:B or DELETE_COLUMNS|A:C\n  INSERT_COLUMNS|ColRange     ‚Üí INSERT_COLUMNS|B:B\n\n‚ñ∏ DATA OPERATIONS\n  COPY|SourceRange|TargetRange\n  SORT|Range|ColumnIndex(0-based)|Ascending(true/false)\n\n‚ñ∏ SHEET OPERATIONS\n  CREATE_SHEET|Name\n  DELETE_SHEET|Name\n  RENAME_SHEET|NewName                    (active sheet)\n  RENAME_SHEET|OldName|NewName            (specific sheet)\n  ACTIVATE_SHEET|Name\n\n‚ñ∏ CHARTS\n  CREATE_CHART|Type|DataRange|Title       (Types: ColumnClustered/Line/Pie/Bar)\n  DELETE_CHART|Title\n  DELETE_ALL_CHARTS\n\n‚ñ∏ SPECIAL\n  UNDO    (ONLY for explicit: "–æ—Ç–º–µ–Ω–∏", "–Ω–∞–∑–∞–¥", "undo", "–≤–µ—Ä–Ω–∏")\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nCRITICAL RULES FOR ROW MOVEMENT\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚ö†Ô∏è RULE 1: INDEX SHIFT AWARENESS\nWhen you INSERT a row, all rows BELOW shift down by 1.\nWhen you DELETE a row, all rows BELOW shift up by 1.\nYou MUST account for this in multi-step operations.\n*NOTE: MOVE_ROW command handles this automatically. Prefer using it if possible.*\n\n‚ö†Ô∏è RULE 2: MOVE ROW ALGORITHM (Manual Steps if not using MOVE_ROW)\n- MOVING ROW DOWN (source < target): INSERT at Target+1, COPY, DELETE Source.\n- MOVING ROW UP (source > target): INSERT at Target, COPY Source+1, DELETE Source+1.\n\n‚ö†Ô∏è RULE 3: LANGUAGE INTERPRETATION (Russian)\n- "–ø–æ–¥ —Å—Ç—Ä–æ–∫–æ–π X" / "–ø–æ—Å–ª–µ X" ‚Üí AFTER row X (insert at X+1)\n- "–Ω–∞–¥ —Å—Ç—Ä–æ–∫–æ–π X" / "–ø–µ—Ä–µ–¥ X" / "–≤—ã—à–µ X" ‚Üí BEFORE row X (insert at X)\n- "–Ω–∞ –º–µ—Å—Ç–æ X" ‚Üí REPLACE position X\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nAMBIGUITY HANDLING\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nIf a value appears in MULTIPLE rows:\n‚ùå DO NOT execute\n‚úÖ ASK: "–ù–∞—à—ë–ª \'–ò–≤–∞–Ω–æ–≤\' –≤ —Å—Ç—Ä–æ–∫–∞—Ö 4 –∏ 12. –ö–∞–∫—É—é —Å—Ç—Ä–æ–∫—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å?"\n\nIf command is unclear:\n‚ùå DO NOT guess\n‚úÖ ASK for clarification\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nOUTPUT FORMAT\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚úÖ Commands ONLY (one per line, no extra text)\n‚úÖ OR clarifying question ONLY (no commands mixed in)\n‚ùå NEVER mix commands with explanatory text',i&&i.sheetName&&(c+="\n\nCURRENT EXCEL CONTEXT:\nSheet: ".concat(i.sheetName,"\nSelection: ").concat(i.address,"\nValues (Selection):\n").concat(JSON.stringify(i.values)),i.usedRange&&(s=i.usedRange.address,u=s.includes("!")?s.split("!")[1]:s,d=u.match(/[A-Z]+(\d+)/i),f=d?parseInt(d[1]):1,p=i.usedRange.values.map(function(e,n){return"Row ".concat(f+n,": ").concat(JSON.stringify(e))}).join("\n"),c+="\n\nSheet Overview (Used Range: ".concat(i.usedRange.address,"):\n").concat(p))),v=[{role:"system",content:c}],O=T[b].messages,S=O,O.length>20&&(S=O.slice(O.length-20)),v.push.apply(v,h(S)),R={role:"user",content:t},v.push(R),I=E.value,A=b,e.p=7,e.n=8,l.complete(v,I,r);case 8:if(P=e.v,_(a),!P.error){e.n=9;break}return L("Error: ".concat(P.error),"ai"),e.a(2);case 9:if(T[A].messages.push(R),T[A].messages.length<=2&&"New Chat"===T[A].title&&(T[A].title=t.substring(0,30)+(t.length>30?"...":"")),T[A].lastModified=Date.now(),C(),M=P.content||"",x={role:"assistant",content:M},T[A].messages.push(x),w(),(k=g.parse(M)).text&&L(k.text,"ai"),k.text||0!==k.commands.length||L(M||"(Empty response)","ai"),!(k.commands.length>0)){e.n=12;break}if((D=U(k.commands)).valid){e.n=10;break}return L("‚ö†Ô∏è Validation Errors:\n".concat(D.errors.join("\n")),"ai"),e.a(2);case 10:return W=L("Executing ".concat(k.commands.length," actions..."),"ai",!0),e.n=11,F(k.commands);case 11:j=e.v,_(W),j.success?(H=k.commands.map(function(e){return e.original}).join("\n"),L("‚úÖ Executed:\n".concat(H),"ai")):L("‚ö†Ô∏è Errors: ".concat(j.errors.join(", ")),"ai");case 12:e.n=14;break;case 13:e.p=13,V=e.v,_(a),L("System Error: ".concat(V),"ai");case 14:return e.a(2)}},e,null,[[7,13],[3,5]])}),G=function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){S(a,r,o,i,c,"next",e)}function c(e){S(a,r,o,i,c,"throw",e)}i(void 0)})},G.apply(this,arguments)}Office.context.ui.addHandlerAsync(Office.EventType.DialogParentMessageReceived,function(e){console.log("Message from parent:",e.message);try{var n=JSON.parse(e.message);"CONTEXT"===n.type&&W?(W(n.data),W=null):"EXECUTION_RESULT"===n.type&&j&&(j(n.data),j=null)}catch(e){console.error("Failed to parse parent message",e)}}),null==t||t.addEventListener("click",H),n.addEventListener("keydown",function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),H())})}(),function(){var e=localStorage.getItem("chat_sessions"),n=localStorage.getItem("current_session_id");if(e)try{T=JSON.parse(e)}catch(e){console.error("Failed to parse sessions",e),T={}}n&&T[n]?b=n:N(),I(),C()}()}!function(e,n,t){(n=E(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t}(g,"NO_ARG_COMMANDS",["UNDO","DELETE_ALL_CHARTS"]),Office.onReady(function(e){e.host===Office.HostType.Excel&&(console.log("Dialog initialized"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",R):R())});var T={},b=null;function w(){localStorage.setItem("chat_sessions",JSON.stringify(T)),localStorage.setItem("current_session_id",b||"")}function N(){var e=Date.now().toString(36)+Math.random().toString(36).slice(2);T[e]={id:e,title:"New Chat",messages:[{role:"assistant",content:"–ü—Ä–∏–≤–µ—Ç! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å Excel."}],lastModified:Date.now()},b=e,w(),I(),C()}function I(){var e=document.getElementById("chat-history");e&&b&&T[b]&&(e.innerHTML="",T[b].messages.forEach(function(e){L(e.content,e.role)}))}var A=null;function C(){var e=document.getElementById("chat-list");e&&(e.innerHTML="",Object.values(T).sort(function(e,n){return n.lastModified-e.lastModified}).forEach(function(n){var t=document.createElement("div");t.className="chat-item ".concat(n.id===b?"active":""),t.onclick=function(){return e=n.id,void(T[e]&&(b=e,w(),I(),C()));var e};var r=document.createElement("span");r.className="chat-item-title",r.textContent=n.title;var o=document.createElement("button");o.type="button",o.className="chat-item-menu-btn",o.innerHTML="‚ãÆ",o.addEventListener("click",function(e){e.stopPropagation(),console.log("Delete menu clicked for session:",n.id),A=n.id;var t=document.getElementById("delete-modal");t?(t.classList.remove("hidden"),t.style.display="flex"):console.error("Delete modal not found in DOM")}),t.appendChild(r),t.appendChild(o),e.appendChild(t)}))}function L(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=document.getElementById("chat-history"),o=document.createElement("div"),a="msg-".concat(Date.now(),"-").concat(Math.random());o.id=a,o.className="message message-".concat(n).concat(t?" temporary":"");var i=document.createElement("div");i.className="avatar",i.textContent="ai"===n?"ü§ñ":"üë§";var c=document.createElement("div");if(c.className="message-content","ai"===n){var s=new marked.Renderer;s.html=function(){return""},c.innerHTML=marked.parse(e,{renderer:s})}else c.innerText=e;return o.appendChild(i),o.appendChild(c),r&&(r.appendChild(o),r.scrollTop=r.scrollHeight),a}function _(e){var n=document.getElementById(e);n&&n.remove()}}(),new URL(t(37496),t.b)}();
//# sourceMappingURL=dialog.js.map